bun test v1.3.4 (5eb2145b)

test/reverse.test.ts:
208 |             getGroupForIndex: (index: number) => items[index]!.sender,
209 |             headerHeight: 30,
210 |             headerTemplate: (group: string) => `<div>${group}</div>`,
211 |           },
212 |         }),
213 |       ).toThrow("[vlist] reverse mode cannot be combined with groups");
              ^
error: expect(received).toThrow(expected)

Expected substring: "[vlist] reverse mode cannot be combined with groups"
Received message: "[vlist/builder] withGroups cannot be used with reverse: true"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:213:9)
(fail) reverse mode > validation > should throw when combined with groups [1.81ms]
226 |             template: (msg: ChatMessage) => `<div>${msg.text}</div>`,
227 |           },
228 |           items,
229 |           reverse: true,
230 |         }),
231 |       ).toThrow("[vlist] reverse mode cannot be combined with grid layout");
              ^
error: expect(received).toThrow(expected)

Expected substring: "[vlist] reverse mode cannot be combined with grid layout"
Received message: "[vlist/builder] withGrid cannot be used with reverse: true"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:231:9)
(fail) reverse mode > validation > should throw when combined with grid layout [0.24ms]
(pass) reverse mode > validation > should accept reverse: true without groups or grid [28.78ms]
(pass) reverse mode > validation > should work with reverse: false (default behavior) [6.27ms]
(pass) reverse mode > validation > should work without reverse option (undefined = false) [3.55ms]
(pass) reverse mode > initial scroll to bottom > should start scrolled to the bottom with static items [9.25ms]
(pass) reverse mode > initial scroll to bottom > should handle empty items gracefully [1.90ms]
(pass) reverse mode > initial scroll to bottom > should handle few items that fit in viewport [2.65ms]
331 | 
332 |       // Append a new message
333 |       const newMessages = createMessages(1, 101);
334 |       list.appendItems(newMessages);
335 | 
336 |       expect(list.total).toBe(101);
                               ^
error: expect(received).toBe(expected)

Expected: 101
Received: 100

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:336:26)
(fail) reverse mode > appendItems auto-scroll > should auto-scroll to bottom when appending and user was at bottom [7.33ms]
352 |       for (let batch = 0; batch < 3; batch++) {
353 |         const newMessages = createMessages(5, 51 + batch * 5);
354 |         list.appendItems(newMessages);
355 |       }
356 | 
357 |       expect(list.total).toBe(65);
                               ^
error: expect(received).toBe(expected)

Expected: 65
Received: 50

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:357:26)
(fail) reverse mode > appendItems auto-scroll > should append multiple messages and keep scrolling to bottom [10.08ms]
363 |       const list = createVList(createBasicConfig(container, []));
364 | 
365 |       expect(list.total).toBe(0);
366 | 
367 |       list.appendItems(createMessages(10));
368 |       expect(list.total).toBe(10);
                               ^
error: expect(received).toBe(expected)

Expected: 10
Received: 0

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:368:26)
(fail) reverse mode > appendItems auto-scroll > should not crash when appending to empty list in reverse mode [7.63ms]
386 | 
387 |       // Prepend older messages
388 |       const olderMessages = createMessages(10, -9); // IDs: -9 to 0
389 |       list.prependItems(olderMessages);
390 | 
391 |       expect(list.total).toBe(60);
                               ^
error: expect(received).toBe(expected)

Expected: 60
Received: 50

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:391:26)
(fail) reverse mode > prependItems scroll preservation > should preserve scroll position when prepending items [7.20ms]
404 | 
405 |     it("should handle prepending to an empty list", () => {
406 |       const list = createVList(createBasicConfig(container, []));
407 | 
408 |       list.prependItems(createMessages(20));
409 |       expect(list.total).toBe(20);
                               ^
error: expect(received).toBe(expected)

Expected: 20
Received: 0

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:409:26)
(fail) reverse mode > prependItems scroll preservation > should handle prepending to an empty list [2.98ms]
419 |       for (let batch = 0; batch < 3; batch++) {
420 |         const olderMessages = createMessages(10, (2 - batch) * 10 + 1);
421 |         list.prependItems(olderMessages);
422 |       }
423 | 
424 |       expect(list.total).toBe(60);
                               ^
error: expect(received).toBe(expected)

Expected: 60
Received: 30

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:424:26)
(fail) reverse mode > prependItems scroll preservation > should handle multiple sequential prepends [9.33ms]
433 |       list.scrollToIndex(25, "center");
434 |       const scrollBefore = list.getScrollPosition();
435 | 
436 |       list.prependItems(createMessages(1, 0));
437 | 
438 |       expect(list.total).toBe(51);
                               ^
error: expect(received).toBe(expected)

Expected: 51
Received: 50

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:438:26)
(fail) reverse mode > prependItems scroll preservation > should preserve scroll when prepending a single item [5.55ms]
457 |       expect(list.total).toBe(20);
458 | 
459 |       const newItems = createMessages(50);
460 |       list.setItems(newItems);
461 | 
462 |       expect(list.total).toBe(50);
                               ^
error: expect(received).toBe(expected)

Expected: 50
Received: 20

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:462:26)
(fail) reverse mode > setItems in reverse mode > should replace items and keep total correct [3.45ms]
467 |     it("should allow clearing and resetting items", () => {
468 |       const items = createMessages(30);
469 |       const list = createVList(createBasicConfig(container, items));
470 | 
471 |       list.setItems([]);
472 |       expect(list.total).toBe(0);
                               ^
error: expect(received).toBe(expected)

Expected: 0
Received: 30

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:472:26)
(fail) reverse mode > setItems in reverse mode > should allow clearing and resetting items [3.50ms]
(pass) reverse mode > data methods > should support updateItem in reverse mode [4.31ms]
498 |     it("should support removeItem in reverse mode", () => {
499 |       const items = createMessages(20);
500 |       const list = createVList(createBasicConfig(container, items));
501 | 
502 |       list.removeItem(10);
503 |       expect(list.total).toBe(19);
                               ^
error: expect(received).toBe(expected)

Expected: 19
Received: 20

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:503:26)
(fail) reverse mode > data methods > should support removeItem in reverse mode [6.69ms]
(pass) reverse mode > selection > should support selection in reverse mode [8.11ms]
(pass) reverse mode > selection > should support multiple selection in reverse mode [4.62ms]
(pass) reverse mode > events > should emit events normally in reverse mode [4.57ms]
(pass) reverse mode > scroll save/restore > should support getScrollSnapshot in reverse mode [3.86ms]
(pass) reverse mode > scroll save/restore > should support restoreScroll in reverse mode [5.13ms]
(pass) reverse mode > variable heights > should work with function-based heights in reverse mode [3.63ms]
642 | 
643 |       list.scrollToIndex(15, "center");
644 |       const scrollBefore = list.getScrollPosition();
645 | 
646 |       list.prependItems(createMessages(5, -4));
647 |       expect(list.total).toBe(35);
                               ^
error: expect(received).toBe(expected)

Expected: 35
Received: 30

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:647:26)
(fail) reverse mode > variable heights > should preserve scroll with variable heights on prepend [3.97ms]
(pass) reverse mode > edge cases > should handle single item in reverse mode [0.47ms]
677 |       for (let i = 0; i < 10; i++) {
678 |         list.appendItems(createMessages(1, 100 + i));
679 |         list.prependItems(createMessages(1, -(i + 1)));
680 |       }
681 | 
682 |       expect(list.total).toBe(40);
                               ^
error: expect(received).toBe(expected)

Expected: 40
Received: 20

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:682:26)
(fail) reverse mode > edge cases > should handle rapid append/prepend operations [18.26ms]
(pass) reverse mode > edge cases > should handle scrollToIndex in reverse mode [3.02ms]
(pass) reverse mode > edge cases > should handle scrollToItem in reverse mode [3.50ms]
(pass) reverse mode > edge cases > should handle cancelScroll in reverse mode [2.88ms]
(pass) reverse mode > edge cases > should handle destroy cleanly in reverse mode [2.86ms]
(pass) reverse mode > edge cases > should work with overscan in reverse mode [6.77ms]
(pass) reverse mode > edge cases > should work with large item counts [4.16ms]
762 | 
763 |       // Without reverse, scroll should start at 0
764 |       expect(list.getScrollPosition()).toBe(0);
765 | 
766 |       list.appendItems(createMessages(5, 101));
767 |       expect(list.total).toBe(105);
                               ^
error: expect(received).toBe(expected)

Expected: 105
Received: 100

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:767:26)
(fail) reverse mode > non-reverse mode unaffected > should not auto-scroll appendItems without reverse [2.55ms]
779 |       );
780 | 
781 |       const scrollBefore = list.getScrollPosition();
782 | 
783 |       list.prependItems(createMessages(10, -9));
784 |       expect(list.total).toBe(60);
                               ^
error: expect(received).toBe(expected)

Expected: 60
Received: 50

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/reverse.test.ts:784:26)
(fail) reverse mode > non-reverse mode unaffected > should not adjust scroll on prependItems without reverse [3.12ms]

test/core.test.ts:
(pass) core createVList > initialization > should create a core vlist instance [3.74ms]
(pass) core createVList > initialization > should throw error without container [0.20ms]
(pass) core createVList > initialization > should throw error without item config [0.05ms]
(pass) core createVList > initialization > should throw error without item.height [0.05ms]
(pass) core createVList > initialization > should throw error with non-positive item.height [0.04ms]
(pass) core createVList > initialization > should throw error with invalid item.height type [0.11ms]
(pass) core createVList > initialization > should throw error without item.template [0.05ms]
(pass) core createVList > initialization > should accept container as string selector [2.68ms]
(pass) core createVList > initialization > should throw for non-existent selector [0.13ms]
(pass) core createVList > initialization > should create proper DOM structure [2.23ms]
(pass) core createVList > initialization > should use custom class prefix [1.09ms]
(pass) core createVList > initialization > should set aria-label when provided [0.87ms]
(pass) core createVList > initialization > should handle empty items array [0.12ms]
(pass) core createVList > initialization > should handle undefined items [0.12ms]
(pass) core createVList > items property > should return readonly items array [0.40ms]
(pass) core createVList > items property > should return total count [2.34ms]
(pass) core createVList > items property > should not share reference with internal state [0.91ms]
(pass) core createVList > data methods > should set items [0.81ms]
(pass) core createVList > data methods > should append items [1.24ms]
(pass) core createVList > data methods > should prepend items [1.03ms]
(pass) core createVList > data methods > should update item [0.90ms]
(pass) core createVList > data methods > should not crash updating non-existent item [0.72ms]
(pass) core createVList > data methods > should remove item [0.86ms]
(pass) core createVList > data methods > should handle removing non-existent item [0.87ms]
(pass) core createVList > data methods > should handle setItems with empty array [1.26ms]
(pass) core createVList > data methods > should handle multiple sequential operations [1.75ms]
(pass) core createVList > scroll methods > should scroll to index [1.88ms]
(pass) core createVList > scroll methods > should scroll to item by ID [1.46ms]
(pass) core createVList > scroll methods > should handle scrollToItem with non-existent ID [1.07ms]
(pass) core createVList > scroll methods > should accept ScrollToOptions object [1.46ms]
(pass) core createVList > scroll methods > should cancel scroll [1.61ms]
(pass) core createVList > scroll methods > should get scroll position [1.37ms]
(pass) core createVList > events > should subscribe to and unsubscribe from events [2.03ms]
(pass) core createVList > events > should emit range:change when items change [1.62ms]
(pass) core createVList > events > should return unsubscribe function from on() [5.77ms]
(pass) core createVList > variable item heights > should support function-based heights [2.03ms]
(pass) core createVList > variable item heights > should render items with correct variable heights [1.61ms]
(pass) core createVList > template > should support string templates [1.78ms]
(pass) core createVList > template > should support HTMLElement templates [0.90ms]
(pass) core createVList > template > should pass index and state to template [0.93ms]
(pass) core createVList > rendering > should render only visible items (virtualization) [1.92ms]
(pass) core createVList > rendering > should render all items when list fits in container [0.38ms]
(pass) core createVList > rendering > should set data-index and data-id on rendered items [1.25ms]
(pass) core createVList > rendering > should set correct translateY positions [1.11ms]
(pass) core createVList > rendering > should set correct content height [1.72ms]
(pass) core createVList > rendering > should update content height when items change [1.76ms]
(pass) core createVList > rendering > should re-render after setItems [0.86ms]
(pass) core createVList > rendering > should use element pooling (items have role=option) [1.49ms]
(pass) core createVList > overscan > should use default overscan of 3 [1.58ms]
(pass) core createVList > overscan > should accept custom overscan [3.28ms]
(pass) core createVList > destroy > should remove DOM on destroy [0.92ms]
(pass) core createVList > destroy > should handle double destroy gracefully [0.77ms]
(pass) core createVList > destroy > should stop emitting events after destroy [0.90ms]
(pass) core createVList > large lists > should handle 10,000 items [2.58ms]
(pass) core createVList > large lists > should handle 100,000 items [9.52ms]
(pass) core createVList > edge cases > should handle single item [0.24ms]
(pass) core createVList > edge cases > should handle items with string IDs [0.87ms]
(pass) core createVList > edge cases > should handle rapid setItems calls [4.26ms]
(pass) core createVList > edge cases > should handle append to empty list [0.84ms]
(pass) core createVList > edge cases > should handle prepend to empty list [0.27ms]
(pass) core createVList > edge cases > should handle remove until empty [0.74ms]
(pass) core createVList > API compatibility with full vlist > should have all core API methods [0.60ms]
(pass) core createVList > API compatibility with full vlist > should NOT have selection methods (core omits them) [0.50ms]
(pass) core createVList > API compatibility with full vlist > should NOT have reload method (core omits adapter support) [0.34ms]
(pass) core createVList > scroll snapshot and restore > should return a snapshot with index and offsetInItem [1.74ms]
(pass) core createVList > scroll snapshot and restore > should return index 0 with 0 offset for initial scroll position [1.52ms]
(pass) core createVList > scroll snapshot and restore > should return index 0 and offsetInItem 0 for empty list [0.17ms]
(pass) core createVList > scroll snapshot and restore > should restore scroll position from snapshot [2.44ms]
(pass) core createVList > scroll snapshot and restore > should clamp snapshot index to valid range [0.75ms]
(pass) core createVList > scroll snapshot and restore > should clamp restored position to max scroll [0.76ms]
(pass) core createVList > scroll snapshot and restore > should be a no-op for empty list on restore [0.13ms]
(pass) core createVList > scroll snapshot and restore > should round-trip snapshot/restore [0.89ms]
(pass) core createVList > scroll snapshot and restore > should have getScrollSnapshot and restoreScroll methods [0.86ms]
(pass) core createVList > window scroll mode > should create list in window scroll mode [1.49ms]
(pass) core createVList > window scroll mode > should render items in window scroll mode [1.59ms]
(pass) core createVList > window scroll mode > should use window.innerHeight as container height in window mode [1.61ms]
(pass) core createVList > window scroll mode > should clean up window event listener on destroy [1.26ms]
(pass) core createVList > window scroll mode > should handle restoreScroll in window mode [2.45ms]
(pass) core createVList > window scroll mode > should scrollToIndex in window mode without error [1.44ms]
(pass) core createVList > variable height rendering paths > should render with variable heights and correct positions [3.20ms]
(pass) core createVList > variable height rendering paths > should compute correct content height with variable heights [1.79ms]
(pass) core createVList > variable height rendering paths > should update content height after setItems with variable heights [1.67ms]
(pass) core createVList > variable height rendering paths > should handle variable heights with scrollToIndex [7.66ms]
(pass) core createVList > variable height rendering paths > should scroll snapshot/restore with variable heights [1.27ms]
(pass) core createVList > variable height rendering paths > should handle variable height function returning constant value [1.32ms]
(pass) core createVList > smooth scroll > should animate smooth scroll to index [102.48ms]
(pass) core createVList > smooth scroll > should cancel ongoing smooth scroll [2.20ms]
(pass) core createVList > smooth scroll > should handle smooth scroll to same position [1.34ms]
(pass) core createVList > smooth scroll > should handle scroll with defaults when no options provided [1.11ms]
(pass) core createVList > resize observer > should emit resize event when container height changes [1.27ms]
(pass) core createVList > event handler edge cases > should survive error in event handler [1.32ms]
(pass) core.ts coverage — HeightCache > fixed height cache > should handle indexAtOffset when total is 0 [0.15ms]
(pass) core.ts coverage — HeightCache > fixed height cache > should handle scrollToIndex at 0 items [0.07ms]
(pass) core.ts coverage — HeightCache > fixed height cache > should cover indexAtOffset clamping [0.75ms]
(pass) core.ts coverage — HeightCache > fixed height cache > should handle height=0 in fixed indexAtOffset [0.32ms]
(pass) core.ts coverage — HeightCache > variable height cache > should handle getOffset edge cases for variable heights [1.09ms]
(pass) core.ts coverage — HeightCache > variable height cache > should handle indexAtOffset with offset <= 0 [1.13ms]
(pass) core.ts coverage — HeightCache > variable height cache > should handle indexAtOffset with very large offset [0.77ms]
(pass) core.ts coverage — HeightCache > variable height cache > should rebuild variable height cache on setItems [1.22ms]
(pass) core.ts coverage — HeightCache > variable height cache > should handle variable height with total=0 for indexAtOffset [0.68ms]
(pass) core.ts coverage — HeightCache > variable height cache > should exercise binary search in indexAtOffset [1.32ms]
(pass) core.ts coverage — HeightCache > variable height cache > should cover getTotalHeight with empty prefix sums [0.42ms]
(pass) core.ts coverage — Emitter > should handle on() creating new listener set for unknown event [0.64ms]
(pass) core.ts coverage — Emitter > should handle off() on event with no subscribers [0.82ms]
(pass) core.ts coverage — Emitter > should survive error in scroll handler [1.20ms]
(pass) core.ts coverage — Emitter > should survive error in range:change handler and continue to next handler [1.08ms]
(pass) core.ts coverage — Emitter > should clear all listeners on destroy [1.09ms]
(pass) core.ts coverage — DOM structure > should create DOM structure without ariaLabel [0.40ms]
(pass) core.ts coverage — DOM structure > should create DOM structure with ariaLabel [0.31ms]
(pass) core.ts coverage — DOM structure > should create viewport, content, and items containers with correct styles [0.99ms]
(pass) core.ts coverage — Element Pool > should acquire new element when pool is empty [0.26ms]
(pass) core.ts coverage — Element Pool > should reuse pooled elements after setItems shrink / grow [2.44ms]
(pass) core.ts coverage — Element Pool > should reset element state on release [1.26ms]
(pass) core.ts coverage — calculateVisibleRange > should return empty range for 0 items [0.06ms]
(pass) core.ts coverage — calculateVisibleRange > should compute correct visible range for items taller than container [0.63ms]
(pass) core.ts coverage — calculateScrollToPosition > should handle align='start' (exercises default switch branch) [1.43ms]
(pass) core.ts coverage — calculateScrollToPosition > should handle align='center' [1.37ms]
(pass) core.ts coverage — calculateScrollToPosition > should handle align='end' [1.24ms]
(pass) core.ts coverage — calculateScrollToPosition > should clamp to 0 when center alignment on first item [1.17ms]
(pass) core.ts coverage — calculateScrollToPosition > should clamp to maxScroll when scrolling to last item with start align [1.20ms]
(pass) core.ts coverage — calculateScrollToPosition > should handle variable-height align='center' [1.25ms]
(pass) core.ts coverage — calculateScrollToPosition > should handle variable-height align='end' [0.26ms]
(pass) core.ts coverage — calculateScrollToPosition > should handle out-of-range index (clamp to valid bounds) [1.72ms]
(pass) core.ts coverage — calculateScrollToPosition > should return 0 for empty items [0.14ms]
(pass) core.ts coverage — applyOverscan > should clamp overscan start to 0 [1.39ms]
(pass) core.ts coverage — applyOverscan > should clamp overscan end to totalItems - 1 [0.91ms]
(pass) core.ts coverage — applyOverscan > should use custom overscan value [1.93ms]
(pass) core.ts coverage — applyOverscan > should use overscan=0 [1.57ms]
(pass) core.ts coverage — renderIfNeeded branches > should bail when render range is unchanged [1.03ms]
(pass) core.ts coverage — renderIfNeeded branches > should update aria-setsize when total items changes [2.00ms]
(pass) core.ts coverage — renderIfNeeded branches > should update existing element when item identity changes [1.23ms]
(pass) core.ts coverage — renderIfNeeded branches > should not update existing element when item identity is the same [0.68ms]
(pass) core.ts coverage — renderIfNeeded branches > should remove items outside new render range when scroll changes [4.16ms]
(pass) core.ts coverage — renderIfNeeded branches > should skip rendering when isDestroyed is true [1.14ms]
(pass) core.ts coverage — renderIfNeeded branches > should handle forceRender after setItems resets lastRenderRange [1.24ms]
(pass) core.ts coverage — renderIfNeeded branches > should handle items that don't exist in array (item undefined check) [0.98ms]
(pass) core.ts coverage — template application > should apply string template via innerHTML [0.70ms]
(pass) core.ts coverage — template application > should apply HTMLElement template via replaceChildren [1.58ms]
(pass) core.ts coverage — template application > should pass correct item state to template [0.62ms]
(pass) core.ts coverage — template application > should update template for existing element with changed identity (HTMLElement) [0.72ms]
(pass) core.ts coverage — handleClick (lines 710-720) > should emit item:click when clicking on a rendered item [1.70ms]
(pass) core.ts coverage — handleClick (lines 710-720) > should not emit when clicking outside any item (no data-index) [1.27ms]
(pass) core.ts coverage — handleClick (lines 710-720) > should not emit when index is negative [1.37ms]
(pass) core.ts coverage — handleClick (lines 710-720) > should not emit when item at index is undefined [0.72ms]
(pass) core.ts coverage — handleClick (lines 710-720) > should not emit clicks after destroy [0.81ms]
(pass) core.ts coverage — handleClick (lines 710-720) > should handle click with empty data-index (NaN parsed) [1.10ms]
(pass) core.ts coverage — ResizeObserver > should emit resize event when viewport height changes significantly [2.20ms]
(pass) core.ts coverage — ResizeObserver > should not emit resize when height difference is <= 1px [1.69ms]
(pass) core.ts coverage — ResizeObserver > should not fire resize after destroy (isDestroyed check) [1.07ms]
(pass) core.ts coverage — ResizeObserver > should skip resize in window mode (isWindowMode check in observer) [2.43ms]
(pass) core.ts coverage — ResizeObserver > should update content height and re-render on resize [3.58ms]
(pass) core.ts coverage — window resize handler (lines 752-762) > should update container height on window resize in window mode [2.82ms]
(pass) core.ts coverage — window resize handler (lines 752-762) > should not emit resize on window resize when diff <= 1px [5.44ms]
(pass) core.ts coverage — window resize handler (lines 752-762) > should not fire window resize after destroy (isDestroyed check) [1.99ms]
(pass) core.ts coverage — window resize handler (lines 752-762) > should not add window resize handler when not in window mode [1.04ms]
(pass) core.ts coverage — scroll handling > should emit scroll event on viewport scroll [1.94ms]
(pass) core.ts coverage — scroll handling > should add scrolling class on scroll [1.57ms]
(pass) core.ts coverage — scroll handling > should remove scrolling class after idle timeout [203.96ms]
(pass) core.ts coverage — scroll handling > should not process scroll when destroyed [2.59ms]
(pass) core.ts coverage — scroll handling > should detect scroll direction down [2.55ms]
(pass) core.ts coverage — scroll handling > should detect scroll direction up [5.64ms]
(pass) core.ts coverage — scroll handling > should not add scrolling class again if already present [2.32ms]
(pass) core.ts coverage — scroll handling > should clear idle timer on subsequent scroll events [256.64ms]
(pass) core.ts coverage — window mode scroll handling > should compute scroll position from window.scrollY in window mode [3.02ms]
(pass) core.ts coverage — window mode scroll handling > should set overflow/height styles for window mode [0.96ms]
(pass) core.ts coverage — window mode scroll handling > should use window.innerHeight for container height in window mode [1.49ms]
(pass) core.ts coverage — resolveScrollArgs > should use default args when no options provided (undefined path) [2.70ms]
(pass) core.ts coverage — resolveScrollArgs > should handle string align argument [2.67ms]
(pass) core.ts coverage — resolveScrollArgs > should handle object with all options [2.14ms]
(pass) core.ts coverage — resolveScrollArgs > should handle object with partial options (defaults fill in) [1.96ms]
(pass) core.ts coverage — resolveScrollArgs > should handle empty object (all defaults) [1.90ms]
(pass) core.ts coverage — doScrollTo > should set viewport.scrollTop in normal mode [1.39ms]
(pass) core.ts coverage — doScrollTo > should call window.scrollTo in window mode [1.85ms]
(pass) core.ts coverage — animateScroll > should snap when distance < 1 (from === to) [1.74ms]
(pass) core.ts coverage — animateScroll > should animate when distance >= 1 [103.33ms]
(pass) core.ts coverage — animateScroll > should cancel previous animation when starting new one [103.20ms]
(pass) core.ts coverage — animateScroll > should call cancelScroll before auto scroll [1.98ms]
(pass) core.ts coverage — scrollToItem > should scroll to item by ID (found) [1.59ms]
(pass) core.ts coverage — scrollToItem > should not scroll when item ID not found (index < 0) [1.52ms]
(pass) core.ts coverage — scrollToItem > should pass string align to scrollToItem [1.01ms]
(pass) core.ts coverage — scrollToItem > should pass ScrollToOptions object to scrollToItem [1.26ms]
(pass) core.ts coverage — restoreScroll > should restore scroll in non-window mode via viewport.scrollTo [3.04ms]
(pass) core.ts coverage — restoreScroll > should restore scroll in window mode via window.scrollTo [4.04ms]
(pass) core.ts coverage — restoreScroll > should clamp snapshot index to valid range on restore [0.88ms]
(pass) core.ts coverage — restoreScroll > should be a no-op for empty list on restoreScroll [0.16ms]
(pass) core.ts coverage — getScrollSnapshot > should return {0, 0} for empty list [0.25ms]
(pass) core.ts coverage — getScrollSnapshot > should compute correct snapshot after restoreScroll [3.15ms]
(pass) core.ts coverage — getScrollSnapshot > should compute offsetInItem correctly with variable heights [2.24ms]
(pass) core.ts coverage — updateItem in-place rendering > should update visible item template in-place [1.21ms]
(pass) core.ts coverage — updateItem in-place rendering > should update data-id on visible item via updateItem [1.07ms]
(pass) core.ts coverage — updateItem in-place rendering > should not crash on updateItem for non-existent ID [0.22ms]
(pass) core.ts coverage — updateItem in-place rendering > should not crash on updateItem for item outside visible range [1.69ms]
(pass) core.ts coverage — positionElement > should set translateY based on height cache offset [1.47ms]
(pass) core.ts coverage — positionElement > should use Math.round for variable height offsets [0.97ms]
(pass) core.ts coverage — ARIA attributes > should set unique aria IDs per instance [1.20ms]
(pass) core.ts coverage — ARIA attributes > should set aria-setsize and aria-posinset on rendered items [1.58ms]
(pass) core.ts coverage — ARIA attributes > should set aria-selected to false on core items [1.24ms]
(pass) core.ts coverage — ARIA attributes > should set listbox role and tabindex on root [0.94ms]
(pass) core.ts coverage — easeInOutQuad > should apply easing during smooth scroll (multi-frame animation) [63.07ms]
(pass) core.ts coverage — destroy cleanup > should remove DOM root from container on destroy [0.89ms]
(pass) core.ts coverage — destroy cleanup > should release all rendered elements to pool on destroy [1.85ms]
(pass) core.ts coverage — destroy cleanup > should cancel ongoing smooth scroll on destroy [52.68ms]
(pass) core.ts coverage — destroy cleanup > should clear idle timer on destroy [204.61ms]
(pass) core.ts coverage — destroy cleanup > should be safe to call destroy twice [4.68ms]
(pass) core.ts coverage — destroy cleanup > should disconnect ResizeObserver on destroy [3.29ms]
(pass) core.ts coverage — destroy cleanup > should remove window resize listener in window mode on destroy [1.20ms]
(pass) core.ts coverage — data methods > should appendItems and re-render [0.88ms]
(pass) core.ts coverage — data methods > should prependItems and re-render [0.95ms]
(pass) core.ts coverage — data methods > should removeItem and re-render [0.84ms]
(pass) core.ts coverage — data methods > should handle removeItem with non-existent ID [0.96ms]
(pass) core.ts coverage — data methods > should setItems to empty and back [1.65ms]
(pass) core.ts coverage — contentHeight updates > should set correct content height for fixed-height items [1.36ms]
(pass) core.ts coverage — contentHeight updates > should update content height after setItems [1.28ms]
(pass) core.ts coverage — contentHeight updates > should set 0 height for empty list [0.13ms]
(pass) core.ts coverage — contentHeight updates > should set correct content height for variable-height items [0.50ms]
(pass) core.ts coverage — multiple instances with unique IDs > should use incremented instance IDs for ARIA prefixes [0.67ms]
(pass) core.ts coverage — on/off event subscription > should return an unsubscribe function from on() [1.16ms]
(pass) core.ts coverage — on/off event subscription > should unsubscribe via off() [1.17ms]

test/vlist-coverage.test.ts:
(pass) vlist scrollbar mode resolution > should use native scrollbar mode via scroll.scrollbar = 'native' [6.41ms]
(pass) vlist scrollbar mode resolution > should use none scrollbar mode via scroll.scrollbar = 'none' [2.75ms]
(pass) vlist scrollbar mode resolution > should use custom scrollbar mode via scroll.scrollbar = object [3.12ms]
(pass) vlist scrollbar mode resolution > should use none mode via legacy scrollbar config with enabled=false [3.54ms]
(pass) vlist scrollbar mode resolution > should use custom mode via legacy scrollbar config with enabled=true [3.26ms]
(pass) vlist scrollbar mode resolution > should default to custom scrollbar when no scroll config is provided [2.70ms]
(pass) vlist scrollbar mode resolution > should fallback to custom scrollbar when native mode list is compressed [63.54ms]
(pass) vlist scrollbar mode resolution > should not create scrollbar when mode is none even with compression [54.35ms]
365 |       layout: "grid",
366 |       grid: { columns: 3, gap: 10 },
367 |     });
368 | 
369 |     expect(vlist).toBeDefined();
370 |     expect(vlist.total).toBe(30);
                              ^
error: expect(received).toBe(expected)

Expected: 30
Received: 10

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:370:25)
(fail) vlist grid gap with function height > should inflate function-based heights by grid gap [16.86ms]
383 |       layout: "grid",
384 |       grid: { columns: 3, gap: 8 },
385 |     });
386 | 
387 |     expect(vlist).toBeDefined();
388 |     expect(vlist.total).toBe(30);
                              ^
error: expect(received).toBe(expected)

Expected: 30
Received: 10

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:388:25)
(fail) vlist grid gap with function height > should inflate numeric heights by grid gap [4.90ms]
401 |       layout: "grid",
402 |       grid: { columns: 3, gap: 0 },
403 |     });
404 | 
405 |     expect(vlist).toBeDefined();
406 |     expect(vlist.total).toBe(30);
                              ^
error: expect(received).toBe(expected)

Expected: 30
Received: 10

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:406:25)
(fail) vlist grid gap with function height > should handle grid gap of 0 without modifying height function [4.86ms]
(pass) vlist off() event method > should unsubscribe handler using off() [3.73ms]
(pass) vlist off() event method > should not throw when calling off() with unregistered handler [1.48ms]
(pass) vlist off() event method > should allow re-subscribing after off() [2.79ms]
535 |     // Use JSDOM's Event constructor (not Bun's global Event)
536 |     const ResizeEvent = (window as any).Event || dom.window.Event;
537 |     window.dispatchEvent(new ResizeEvent("resize"));
538 | 
539 |     // The resize handler should have been called (containerHeight changed)
540 |     expect(resizeHandler).toHaveBeenCalled();
                                ^
error: expect(received).toHaveBeenCalled()

Expected number of calls: >= 1
Received number of calls: 0

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:540:27)
(fail) vlist window resize handler > should handle window resize in window scroll mode [3.64ms]
(pass) vlist window resize handler > should not emit resize when height difference is <= 1px [2.23ms]
(pass) vlist window resize handler > should not respond to resize after destroy [1.85ms]
(pass) vlist window resize handler > should use legacy scrollElement for window mode [2.10ms]
654 |     expect(vlist.total).toBe(100);
655 | 
656 |     // The native mode shouldn't have a custom scrollbar initially
657 |     // Now grow the list to trigger compression
658 |     vlist.setItems(createTestItems(500_000));
659 |     expect(vlist.total).toBe(500_000);
                              ^
error: expect(received).toBe(expected)

Expected: 500000
Received: 100

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:659:25)
(fail) vlist compression mode transitions > should create custom scrollbar when entering compression with native mode [47.61ms]
678 | 
679 |     expect(vlist.total).toBe(500_000);
680 | 
681 |     // Shrink below compression threshold
682 |     vlist.setItems(createTestItems(100));
683 |     expect(vlist.total).toBe(100);
                              ^
error: expect(received).toBe(expected)

Expected: 100
Received: 500000

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:683:25)
(fail) vlist compression mode transitions > should transition from compressed to uncompressed when items shrink [46.59ms]
696 |       items,
697 |     });
698 | 
699 |     // Change to different compressed size
700 |     vlist.setItems(createTestItems(1_000_000));
701 |     expect(vlist.total).toBe(1_000_000);
                              ^
error: expect(received).toBe(expected)

Expected: 1000000
Received: 500000

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:701:25)
(fail) vlist compression mode transitions > should update compression when already compressed and total changes [182.54ms]
715 |       scroll: { scrollbar: "none" },
716 |     });
717 | 
718 |     // Grow to trigger compression
719 |     vlist.setItems(createTestItems(500_000));
720 |     expect(vlist.total).toBe(500_000);
                              ^
error: expect(received).toBe(expected)

Expected: 500000
Received: 100

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:720:25)
(fail) vlist compression mode transitions > should not create scrollbar on compression when mode is none [45.02ms]
735 |     });
736 | 
737 |     // In default mode, scrollbar already exists.
738 |     // Growing to compression should update scrollbar bounds
739 |     vlist.setItems(createTestItems(500_000));
740 |     expect(vlist.total).toBe(500_000);
                              ^
error: expect(received).toBe(expected)

Expected: 500000
Received: 20

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:740:25)
(fail) vlist compression mode transitions > should create scrollbar on compression with default custom mode [43.90ms]
798 |         sticky: true,
799 |       },
800 |     });
801 | 
802 |     expect(vlist).toBeDefined();
803 |     expect(vlist.total).toBe(8);
                              ^
error: expect(received).toBe(expected)

Expected: 8
Received: 11

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:803:25)
(fail) vlist sticky header wrapping > should create sticky header when groups.sticky is true [4.27ms]
(pass) vlist sticky header wrapping > should update sticky header on scroll [2.45ms]
875 | 
876 |     // The wrappedHandleScroll should have called both originalHandleScroll
877 |     // and stickyRef.update(scrollTop). Verify the sticky element is still present
878 |     // and the list didn't crash.
879 |     expect(stickyEl).toBeTruthy();
880 |     expect(vlist.total).toBe(8);
                              ^
error: expect(received).toBe(expected)

Expected: 8
Received: 11

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:880:25)
(fail) vlist sticky header wrapping > should invoke wrappedHandleScroll via native scroll event on viewport [25.44ms]
915 |     await new Promise((r) => setTimeout(r, 100));
916 | 
917 |     // The onIdle callback should have run and called loadPendingRange
918 |     // on the wrappedHandleScroll. Verify no crash.
919 |     expect(root.classList.contains("vlist--scrolling")).toBe(false);
920 |     expect(vlist.total).toBe(8);
                              ^
error: expect(received).toBe(expected)

Expected: 8
Received: 11

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:920:25)
(fail) vlist sticky header wrapping > should invoke wrappedHandleScroll with loadPendingRange forwarded [127.24ms]
(pass) vlist sticky header wrapping > should destroy sticky header on cleanup [2.53ms]
(pass) vlist groups scrollToIndex wrapper > should convert data index to layout index when scrolling in group mode [1.72ms]
(pass) vlist groups scrollToIndex wrapper > should handle scrollToIndex with options object in group mode [1.39ms]
(pass) vlist groups scrollToIndex wrapper > should use scrollToIndex with sticky groups [1.74ms]
1103 | 
1104 |     // Wait for the async load
1105 |     await new Promise((r) => setTimeout(r, 50));
1106 | 
1107 |     expect(readMock).toHaveBeenCalled();
1108 |     expect(vlist.total).toBeGreaterThan(0);
                               ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:1108:25)
(fail) vlist adapter initial load > should load initial data from adapter when no items provided [55.44ms]
1139 |     });
1140 | 
1141 |     await new Promise((r) => setTimeout(r, 100));
1142 | 
1143 |     // Verify the adapter was called (loadInitial ran)
1144 |     expect(vlist.total).toBeGreaterThan(0);
                               ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:1144:25)
(fail) vlist adapter initial load > should emit load:start and load:end events on adapter initial load [102.07ms]
(pass) vlist adapter initial load > should handle adapter read failure gracefully without crashing [103.81ms]
1195 | 
1196 |     // When items are provided, loadInitial should NOT be called
1197 |     // (the read mock should not have been invoked at init time)
1198 |     // Note: readMock might be called for preloading — just verify it didn't
1199 |     // call with offset 0 as the initial load
1200 |     expect(vlist.total).toBe(10);
                               ^
error: expect(received).toBe(expected)

Expected: 10
Received: 0

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:1200:25)
(fail) vlist adapter initial load > should not call loadInitial when items are provided with adapter [59.70ms]
1239 |     });
1240 | 
1241 |     // Wait for adapter to load and auto-scroll
1242 |     await new Promise((r) => setTimeout(r, 100));
1243 | 
1244 |     expect(vlist.total).toBeGreaterThan(0);
                               ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:1244:25)
(fail) vlist reverse mode with adapter > should scroll to bottom after adapter load completes in reverse mode [106.68ms]
(pass) vlist reverse mode with adapter > should handle reverse mode with static items (no adapter) [11.02ms]
(pass) vlist reverse mode with adapter > should handle reverse mode with empty adapter [105.34ms]
(pass) vlist scroll controller onIdle > should add scrolling class on scroll and remove on idle [211.64ms]
(pass) vlist scroll controller onIdle > should call onIdle callback when scroll stops via native scroll event [128.57ms]
(pass) vlist scroll controller onIdle > should use legacy idleTimeout config [6.28ms]
(pass) vlist scroll config new API > should disable wheel scrolling via scroll.wheel = false [2.19ms]
(pass) vlist scroll config new API > should enable wrap mode via scroll.wrap = true [2.20ms]
(pass) vlist scroll config new API > should use scroll.element for window mode [2.52ms]
(pass) vlist scroll config new API > should use scroll.idleTimeout [2.05ms]
(pass) vlist window mode via scroll config > should clean up window resize listener on destroy [4.74ms]
(pass) vlist window mode via scroll config > should handle window mode with compression [62.97ms]
(pass) vlist window mode via scroll config > should update viewport on significant window resize [3.01ms]
(pass) vlist compression scrollbar creation > should create scrollbar on compression entry when mode is native and no scrollbar exists [53.02ms]
1588 |       items,
1589 |     });
1590 | 
1591 |     // Compress
1592 |     vlist.setItems(createTestItems(500_000));
1593 |     expect(vlist.total).toBe(500_000);
                               ^
error: expect(received).toBe(expected)

Expected: 500000
Received: 100

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:1593:25)
(fail) vlist compression scrollbar creation > should handle multiple compression/decompression cycles [45.32ms]
1617 |       items,
1618 |     });
1619 | 
1620 |     // Change total while compressed
1621 |     vlist.setItems(createTestItems(800_000));
1622 |     expect(vlist.total).toBe(800_000);
                               ^
error: expect(received).toBe(expected)

Expected: 800000
Received: 500000

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:1622:25)
(fail) vlist compression scrollbar creation > should update scrollbar bounds when compression state changes [154.31ms]
1662 | 
1663 |     expect(vlist).toBeDefined();
1664 | 
1665 |     // Change items (triggers updateCompressionMode which should sync maxScroll)
1666 |     vlist.setItems(createTestItems(200));
1667 |     expect(vlist.total).toBe(200);
                               ^
error: expect(received).toBe(expected)

Expected: 200
Received: 100

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:1667:25)
(fail) vlist window mode compression sync > should sync maxScroll in window mode even without compression [4.11ms]
1677 |     });
1678 | 
1679 |     expect(vlist).toBeDefined();
1680 | 
1681 |     vlist.setItems(createTestItems(600_000));
1682 |     expect(vlist.total).toBe(600_000);
                               ^
error: expect(received).toBe(expected)

Expected: 600000
Received: 500000

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:1682:25)
(fail) vlist window mode compression sync > should sync maxScroll in window mode with compression [86.24ms]
(pass) vlist additional edge cases > should handle on() returning unsubscribe for multiple event types [2.88ms]
1737 |       layout: "grid",
1738 |       grid: { columns: 4, gap: 12 },
1739 |     });
1740 | 
1741 |     expect(vlist).toBeDefined();
1742 |     expect(vlist.total).toBe(60);
                               ^
error: expect(received).toBe(expected)

Expected: 60
Received: 15

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:1742:25)
(fail) vlist additional edge cases > should handle grid mode with variable height function and gap [7.10ms]
1786 |     currentItems = newItems;
1787 |     vlist.setItems(newItems);
1788 | 
1789 |     // scrollToIndex should use the groups wrapper
1790 |     expect(() => vlist!.scrollToIndex(3, "center")).not.toThrow();
1791 |     expect(vlist.total).toBe(5);
                               ^
error: expect(received).toBe(expected)

Expected: 5
Received: 6

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:1791:25)
(fail) vlist additional edge cases > should handle groups with setItems rebuilding layout and then scrollToIndex [2.69ms]
(pass) vlist additional edge cases > should handle reverse mode with static items scrolling to bottom [3.27ms]
1820 | 
1821 |     expect(vlist).toBeDefined();
1822 | 
1823 |     // Change items to trigger updateCompressionMode in window mode
1824 |     vlist.setItems(createTestItems(100));
1825 |     expect(vlist.total).toBe(100);
                               ^
error: expect(received).toBe(expected)

Expected: 100
Received: 50

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/vlist-coverage.test.ts:1825:25)
(fail) vlist additional edge cases > should handle window mode with native scrollbar and items change [4.22ms]

test/accessibility.test.ts:
(pass) aria-setsize and aria-posinset > should set aria-setsize on all rendered items [3.61ms]
(pass) aria-setsize and aria-posinset > should set aria-posinset (1-based) on all rendered items [3.04ms]
(pass) aria-setsize and aria-posinset > should update aria-setsize when items are appended [4.44ms]
(pass) aria-setsize and aria-posinset > should update aria-setsize when items are replaced [3.33ms]
(pass) aria-setsize and aria-posinset > should handle single item correctly [1.99ms]
(pass) aria-setsize and aria-posinset > should work with variable item heights [2.95ms]
(pass) unique element IDs > should assign unique IDs to rendered items [6.80ms]
(pass) unique element IDs > should include the item index in the element ID [2.53ms]
(pass) unique element IDs > should generate different ID prefixes for multiple instances [3.00ms]
(pass) aria-activedescendant > should not set aria-activedescendant initially [2.39ms]
(pass) aria-activedescendant > should set aria-activedescendant on ArrowDown [3.65ms]
(pass) aria-activedescendant > should update aria-activedescendant as focus moves [3.44ms]
(pass) aria-activedescendant > should update aria-activedescendant on Home and End [4.51ms]
(pass) aria-activedescendant > should reference an existing element with matching ID [2.72ms]
(pass) aria-activedescendant > should update aria-activedescendant on item click with selection [3.70ms]
(pass) aria-activedescendant > should not set aria-activedescendant when selection mode is none [1.80ms]
(pass) aria-busy > should not have aria-busy without adapter [2.11ms]
(pass) aria-busy > should set aria-busy when adapter starts loading [25.59ms]
(pass) live region > should create a live region element [3.47ms]
(pass) live region > should have the live region visually hidden [3.24ms]
729 |     });
730 | 
731 |     vlist.select(1);
732 | 
733 |     const liveRegion = vlist.element.querySelector('[aria-live="polite"]');
734 |     expect(liveRegion?.textContent).toBe("1 item selected");
                                          ^
error: expect(received).toBe(expected)

Expected: "1 item selected"
Received: ""

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/accessibility.test.ts:734:37)
(fail) live region > should announce single selection [3.92ms]
744 |     });
745 | 
746 |     vlist.select(1, 2, 3);
747 | 
748 |     const liveRegion = vlist.element.querySelector('[aria-live="polite"]');
749 |     expect(liveRegion?.textContent).toBe("3 items selected");
                                          ^
error: expect(received).toBe(expected)

Expected: "3 items selected"
Received: ""

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/accessibility.test.ts:749:37)
(fail) live region > should announce multiple selections [3.97ms]
758 |       selection: { mode: "multiple" },
759 |     });
760 | 
761 |     vlist.select(1, 2);
762 |     const liveRegion = vlist.element.querySelector('[aria-live="polite"]');
763 |     expect(liveRegion?.textContent).toBe("2 items selected");
                                          ^
error: expect(received).toBe(expected)

Expected: "2 items selected"
Received: ""

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/accessibility.test.ts:763:37)
(fail) live region > should clear announcement when selection is cleared [3.71ms]
776 |     });
777 | 
778 |     const liveRegion = vlist.element.querySelector('[aria-live="polite"]');
779 | 
780 |     vlist.select(1);
781 |     expect(liveRegion?.textContent).toBe("1 item selected");
                                          ^
error: expect(received).toBe(expected)

Expected: "1 item selected"
Received: ""

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/accessibility.test.ts:781:37)
(fail) live region > should update announcement as selection changes [3.16ms]
(pass) live region > should still create live region without selection mode [2.52ms]
(pass) live region > should remove live region on destroy [3.44ms]
(pass) baseline ARIA attributes > should have role=listbox on root [1.73ms]
(pass) baseline ARIA attributes > should have role=option on each item [1.51ms]
(pass) baseline ARIA attributes > should have tabindex=0 on root for focusability [0.37ms]
(pass) baseline ARIA attributes > should set aria-label when provided [2.58ms]
(pass) baseline ARIA attributes > should set aria-selected on items [3.29ms]
(pass) core vlist accessibility > should set aria-setsize and aria-posinset on core items [1.58ms]
(pass) core vlist accessibility > should assign unique IDs to core items [1.10ms]
(pass) core vlist accessibility > should update aria-setsize when core items change [1.28ms]
(pass) core vlist accessibility > should have role=listbox and role=option in core mode [0.52ms]
(pass) grid mode accessibility > should set aria-setsize to total items (not rows) in grid mode [5.45ms]
(pass) grid mode accessibility > should set aria-posinset based on flat item index in grid mode [4.02ms]
(pass) grid mode accessibility > should assign unique IDs in grid mode [4.10ms]
1139 |     const activeId = vlist.element.getAttribute("aria-activedescendant");
1140 |     expect(activeId).toBeTruthy();
1141 | 
1142 |     // Live region should announce the selection
1143 |     const liveRegion = vlist.element.querySelector('[aria-live="polite"]');
1144 |     expect(liveRegion?.textContent).toBe("1 item selected");
                                           ^
error: expect(received).toBe(expected)

Expected: "1 item selected"
Received: ""

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/accessibility.test.ts:1144:37)
(fail) keyboard navigation ARIA integration > should update both aria-activedescendant and selection announcement on Space [4.29ms]
(pass) keyboard navigation ARIA integration > should maintain all ARIA attributes during rapid keyboard navigation [5.18ms]

test/builder.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '../src/selection/plugin' from '/Users/jvial/Code/floor/vlist/test/builder.test.ts'
-------------------------------


test/integration.test.ts:
(pass) createVList > initialization > should create a vlist instance [2.60ms]
197 |         createVList({
198 |           container: null as any,
199 |           item: { height: 40, template },
200 |           items: [],
201 |         });
202 |       }).toThrow("[vlist] Container is required");
               ^
error: expect(received).toThrow(expected)

Expected substring: "[vlist] Container is required"
Received message: "[vlist/builder] Container is required"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:202:10)
(fail) createVList > initialization > should throw error without container [0.47ms]
207 |         createVList({
208 |           container,
209 |           item: undefined as any,
210 |           items: [],
211 |         });
212 |       }).toThrow("[vlist] item configuration is required");
               ^
error: expect(received).toThrow(expected)

Expected substring: "[vlist] item configuration is required"
Received message: "[vlist/builder] item configuration is required"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:212:10)
(fail) createVList > initialization > should throw error without item config [0.05ms]
217 |         createVList({
218 |           container,
219 |           item: { height: 0, template },
220 |           items: [],
221 |         });
222 |       }).toThrow("[vlist] item.height must be a positive number");
               ^
error: expect(received).toThrow(expected)

Expected substring: "[vlist] item.height must be a positive number"
Received message: "[vlist/builder] item.height must be a positive number"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:222:10)
(fail) createVList > initialization > should throw error without item.height [0.07ms]
227 |         createVList({
228 |           container,
229 |           item: { height: 40, template: null as any },
230 |           items: [],
231 |         });
232 |       }).toThrow("[vlist] item.template is required");
               ^
error: expect(received).toThrow(expected)

Expected substring: "[vlist] item.template is required"
Received message: "[vlist/builder] item.template is required"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:232:10)
(fail) createVList > initialization > should throw error without item.template [0.03ms]
(pass) createVList > initialization > should accept container as string selector [1.66ms]
(pass) createVList > initialization > should create DOM structure [2.44ms]
(pass) createVList > initialization > should use custom class prefix [2.04ms]
(pass) createVList > items property > should return readonly items [2.03ms]
(pass) createVList > items property > should return total count [1.99ms]
307 |       });
308 | 
309 |       const newItems = createTestItems(20);
310 |       vlist.setItems(newItems);
311 | 
312 |       expect(vlist.total).toBe(20);
                                ^
error: expect(received).toBe(expected)

Expected: 20
Received: 10

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:312:27)
(fail) createVList > data methods > should set items [2.10ms]
323 |         { id: 11, name: "Item 11" },
324 |         { id: 12, name: "Item 12" },
325 |       ];
326 |       vlist.appendItems(moreItems);
327 | 
328 |       expect(vlist.total).toBe(12);
                                ^
error: expect(received).toBe(expected)

Expected: 12
Received: 10

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:328:27)
(fail) createVList > data methods > should append items [2.43ms]
(pass) createVList > data methods > should update item [2.10ms]
350 |         items: createTestItems(10),
351 |       });
352 | 
353 |       vlist.removeItem(1);
354 | 
355 |       expect(vlist.total).toBe(9);
                                ^
error: expect(received).toBe(expected)

Expected: 9
Received: 10

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:355:27)
(fail) createVList > data methods > should remove item [2.31ms]
(pass) createVList > scroll methods > should scroll to index [2.26ms]
(pass) createVList > scroll methods > should scroll to item by ID [2.26ms]
(pass) createVList > scroll methods > should get scroll position [1.89ms]
(pass) createVList > selection methods > should select items [2.34ms]
(pass) createVList > selection methods > should deselect items [2.54ms]
(pass) createVList > selection methods > should toggle selection [2.29ms]
(pass) createVList > selection methods > should select all in multiple mode [2.43ms]
(pass) createVList > selection methods > should clear selection [2.70ms]
(pass) createVList > selection methods > should get selected items [1.96ms]
(pass) createVList > selection methods > should respect initial selection [1.72ms]
(pass) createVList > events > should subscribe to events [2.14ms]
(pass) createVList > events > should unsubscribe from events [2.55ms]
(pass) createVList > events > should emit range:change when items change [23.37ms]
(pass) createVList > destroy > should clean up on destroy [2.67ms]
(pass) createVList > destroy > should handle double destroy gracefully [1.54ms]
633 | 
634 |     // Wait for initial load
635 |     await new Promise((r) => setTimeout(r, 50));
636 | 
637 |     expect(readMock).toHaveBeenCalled();
638 |     expect(vlist.total).toBeGreaterThan(0);
                              ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:638:25)
(fail) createVList with adapter > should work with async adapter [52.98ms]
669 |     // Wait for initial load to complete
670 |     await new Promise((r) => setTimeout(r, 100));
671 | 
672 |     // The initial load:start was emitted before we subscribed,
673 |     // so just verify the vlist loaded data successfully
674 |     expect(vlist.total).toBeGreaterThan(0);
                              ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:674:25)
(fail) createVList with adapter > should emit load events [104.17ms]
(pass) createVList with large lists > should handle 10,000 items [5.42ms]
(pass) createVList with large lists > should handle 100,000 items [13.67ms]
(pass) createVList with large lists > should enable compression for large lists [107.14ms]
(pass) createVList edge cases > should handle empty items array [0.86ms]
(pass) createVList edge cases > should handle single item [0.78ms]
(pass) createVList edge cases > should handle items with string IDs [1.68ms]
(pass) createVList edge cases > should handle template returning HTMLElement [1.49ms]
828 |       items: createTestItems(10),
829 |       // No selection config
830 |     });
831 | 
832 |     // Selection methods should still exist but do nothing
833 |     vlist.select(1);
                ^
TypeError: vlist.select is not a function. (In 'vlist.select(1)', 'vlist.select' is undefined)
      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:833:11)
(fail) createVList edge cases > should work without selection config [1.59ms]
866 |           container,
867 |           direction: "horizontal",
868 |           item: { height: 40, template },
869 |           items: [],
870 |         });
871 |       }).toThrow(
               ^
error: expect(received).toThrow(expected)

Expected substring: "[vlist] item.width is required when direction is 'horizontal'"
Received message: "[vlist/builder] item.width is required when direction is 'horizontal'"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:871:10)
(fail) createVList horizontal direction > validation > should throw when direction is horizontal but item.width is missing [0.16ms]
879 |           container,
880 |           direction: "horizontal",
881 |           item: { width: 0, template },
882 |           items: [],
883 |         });
884 |       }).toThrow("[vlist] item.width must be a positive number");
               ^
error: expect(received).toThrow(expected)

Expected substring: "[vlist] item.width must be a positive number"
Received message: "[vlist/builder] item.width must be a positive number"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:884:10)
(fail) createVList horizontal direction > validation > should throw when item.width is zero in horizontal mode [0.04ms]
890 |           container,
891 |           direction: "horizontal",
892 |           item: { width: -10, template },
893 |           items: [],
894 |         });
895 |       }).toThrow("[vlist] item.width must be a positive number");
               ^
error: expect(received).toThrow(expected)

Expected substring: "[vlist] item.width must be a positive number"
Received message: "[vlist/builder] item.width must be a positive number"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:895:10)
(fail) createVList horizontal direction > validation > should throw when item.width is negative in horizontal mode [0.12ms]
901 |           container,
902 |           direction: "horizontal",
903 |           item: { width: "100px" as any, template },
904 |           items: [],
905 |         });
906 |       }).toThrow("[vlist] item.width must be a number or a function");
               ^
error: expect(received).toThrow(expected)

Expected substring: "[vlist] item.width must be a number or a function"
Received message: "[vlist/builder] item.width must be a number or a function (index) => number"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:906:10)
(fail) createVList horizontal direction > validation > should throw when item.width is invalid type in horizontal mode [0.04ms]
917 |             key: "group",
918 |             template: () => "",
919 |             height: 30,
920 |           },
921 |         });
922 |       }).toThrow("horizontal direction cannot be combined with groups");
               ^
error: expect(received).toThrow(expected)

Expected substring: "horizontal direction cannot be combined with groups"
Received message: "[vlist/builder] withGroups: getGroupForIndex is required"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:922:10)
(fail) createVList horizontal direction > validation > should throw when horizontal combined with groups [0.12ms]
930 |           item: { width: 100, template },
931 |           items: [],
932 |           layout: "grid",
933 |           grid: { columns: 3 },
934 |         });
935 |       }).toThrow("horizontal direction cannot be combined with grid layout");
               ^
error: expect(received).toThrow(expected)

Expected substring: "horizontal direction cannot be combined with grid layout"
Received message: "[vlist/builder] withGrid cannot be used with direction: 'horizontal'"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:935:10)
(fail) createVList horizontal direction > validation > should throw when horizontal combined with grid layout [0.10ms]
(pass) createVList horizontal direction > validation > should throw when horizontal combined with reverse mode [0.04ms]
(pass) createVList horizontal direction > initialization > should create a horizontal vlist instance [1.62ms]
(pass) createVList horizontal direction > initialization > should accept item.width as a function [1.33ms]
 996 |         direction: "horizontal",
 997 |         item: { width: 100, template },
 998 |         items: createTestItems(10),
 999 |       });
1000 | 
1001 |       expect(vlist.element.classList.contains("vlist--horizontal")).toBe(true);
                                                                           ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1001:69)
(fail) createVList horizontal direction > DOM structure > should add --horizontal class to root [1.41ms]
(pass) createVList horizontal direction > DOM structure > should set aria-orientation to horizontal [1.03ms]
1019 |         item: { width: 100, template },
1020 |         items: createTestItems(10),
1021 |         classPrefix: "mylist",
1022 |       });
1023 | 
1024 |       expect(vlist.element.classList.contains("mylist--horizontal")).toBe(true);
                                                                            ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1024:70)
(fail) createVList horizontal direction > DOM structure > should use custom class prefix with horizontal modifier [1.46ms]
1033 |       });
1034 | 
1035 |       const viewport = vlist.element.querySelector(
1036 |         ".vlist-viewport",
1037 |       ) as HTMLElement;
1038 |       expect(viewport.style.overflowX).toBe("auto");
                                              ^
error: expect(received).toBe(expected)

Expected: "auto"
Received: ""

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1038:40)
(fail) createVList horizontal direction > DOM structure > should set overflowX on viewport instead of overflow [1.88ms]
1049 |       });
1050 | 
1051 |       const content = vlist.element.querySelector(
1052 |         ".vlist-content",
1053 |       ) as HTMLElement;
1054 |       expect(content.style.height).toBe("100%");
                                          ^
error: expect(received).toBe(expected)

Expected: "100%"
Received: ""

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1054:36)
(fail) createVList horizontal direction > DOM structure > should set content height to 100% and width to total scrollable width [1.49ms]
1064 |       });
1065 | 
1066 |       const itemsContainer = vlist.element.querySelector(
1067 |         ".vlist-items",
1068 |       ) as HTMLElement;
1069 |       expect(itemsContainer.style.height).toBe("100%");
                                                 ^
error: expect(received).toBe(expected)

Expected: "100%"
Received: ""

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1069:43)
(fail) createVList horizontal direction > DOM structure > should set items container height to 100% [1.47ms]
(pass) createVList horizontal direction > rendering > should use translateX instead of translateY for item positioning [1.92ms]
(pass) createVList horizontal direction > rendering > should set item width instead of height for main axis [1.30ms]
(pass) createVList horizontal direction > rendering > should set cross-axis height when item.height is provided [1.93ms]
(pass) createVList horizontal direction > rendering > should render only visible items (virtualization) [1.79ms]
(pass) createVList horizontal direction > rendering > should update content width when items change [2.07ms]
(pass) createVList horizontal direction > rendering > should handle variable widths with function [1.53ms]
1197 |         items: createTestItems(5),
1198 |       });
1199 | 
1200 |       const newItems = createTestItems(10);
1201 |       vlist.setItems(newItems);
1202 |       expect(vlist.total).toBe(10);
                                 ^
error: expect(received).toBe(expected)

Expected: 10
Received: 5

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1202:27)
(fail) createVList horizontal direction > data methods > should set items in horizontal mode [1.39ms]
1212 | 
1213 |       vlist.appendItems([
1214 |         { id: 100, name: "Appended 1" },
1215 |         { id: 101, name: "Appended 2" },
1216 |       ]);
1217 |       expect(vlist.total).toBe(7);
                                 ^
error: expect(received).toBe(expected)

Expected: 7
Received: 5

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1217:27)
(fail) createVList horizontal direction > data methods > should append items in horizontal mode [1.45ms]
(pass) createVList horizontal direction > data methods > should handle empty items in horizontal mode [0.70ms]
(pass) createVList horizontal direction > destroy > should clean up horizontal vlist on destroy [1.29ms]
1280 |           container,
1281 |           item: { height: 100, template },
1282 |           items: [],
1283 |           layout: "grid",
1284 |         });
1285 |       }).toThrow("grid configuration is required");
                ^
error: expect(received).toThrow(expected)

Expected substring: "grid configuration is required"

Received function did not throw
Received value: undefined

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1285:10)
(fail) createVList grid mode > validation > should throw when layout is grid but grid config is missing [0.85ms]
1292 |           item: { height: 100, template },
1293 |           items: [],
1294 |           layout: "grid",
1295 |           grid: { columns: 0 },
1296 |         });
1297 |       }).toThrow("grid.columns must be a positive integer");
                ^
error: expect(received).toThrow(expected)

Expected substring: "grid.columns must be a positive integer"
Received message: "[vlist/builder] withGrid: columns must be a positive integer >= 1"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1297:10)
(fail) createVList grid mode > validation > should throw when grid.columns is 0 [0.09ms]
1309 |             key: "group",
1310 |             headerTemplate: () => "<div>Header</div>",
1311 |             height: 30,
1312 |           },
1313 |         });
1314 |       }).toThrow("grid layout cannot be combined with groups");
                ^
error: expect(received).toThrow(expected)

Expected substring: "grid layout cannot be combined with groups"
Received message: "[vlist/builder] withGroups: getGroupForIndex is required"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1314:10)
(fail) createVList grid mode > validation > should throw when grid is combined with groups [0.08ms]
1326 |         grid: { columns: 4 },
1327 |       });
1328 | 
1329 |       expect(vlist).toBeDefined();
1330 |       expect(vlist.element).toBeInstanceOf(HTMLElement);
1331 |       expect(vlist.total).toBe(20);
                                 ^
error: expect(received).toBe(expected)

Expected: 20
Received: 5

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1331:27)
(fail) createVList grid mode > initialization > should create a grid mode vlist [3.15ms]
1340 |         layout: "grid",
1341 |         grid: { columns: 4, gap: 8 },
1342 |       });
1343 | 
1344 |       expect(vlist).toBeDefined();
1345 |       expect(vlist.total).toBe(20);
                                 ^
error: expect(received).toBe(expected)

Expected: 20
Received: 5

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1345:27)
(fail) createVList grid mode > initialization > should create grid with gap [3.19ms]
1357 |       });
1358 | 
1359 |       const newItems = createTestItems(40);
1360 |       vlist.setItems(newItems);
1361 | 
1362 |       expect(vlist.total).toBe(40);
                                 ^
error: expect(received).toBe(expected)

Expected: 40
Received: 5

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1362:27)
(fail) createVList grid mode > data methods > should set items in grid mode [4.74ms]
1374 |       vlist.appendItems([
1375 |         { id: 100, name: "Appended 1", value: 100 },
1376 |         { id: 101, name: "Appended 2", value: 101 },
1377 |       ]);
1378 | 
1379 |       expect(vlist.total).toBe(10);
                                 ^
error: expect(received).toBe(expected)

Expected: 10
Received: 2

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1379:27)
(fail) createVList grid mode > data methods > should append items in grid mode [2.86ms]
1388 |         grid: { columns: 4 },
1389 |       });
1390 | 
1391 |       vlist.removeItem(3);
1392 | 
1393 |       expect(vlist.total).toBe(7);
                                 ^
error: expect(received).toBe(expected)

Expected: 7
Received: 2

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1393:27)
(fail) createVList grid mode > data methods > should remove item in grid mode [2.02ms]
(pass) createVList grid mode > scroll methods > should scroll to index in grid mode [11.07ms]
(pass) createVList grid mode > snapshot > should get scroll snapshot in grid mode [4.29ms]
(pass) createVList grid mode > snapshot > should convert row index to item index in grid snapshot [4.68ms]
(pass) createVList grid mode > snapshot > should restore scroll from snapshot in grid mode [5.42ms]
(pass) createVList grid mode > destroy > should clean up grid mode vlist [2.74ms]
1560 |       });
1561 | 
1562 |       expect(vlist).toBeDefined();
1563 |       expect(vlist.element).toBeInstanceOf(HTMLElement);
1564 |       // total returns original items (without headers)
1565 |       expect(vlist.total).toBe(8);
                                 ^
error: expect(received).toBe(expected)

Expected: 8
Received: 11

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1565:27)
(fail) createVList groups mode > initialization > should create a grouped vlist [1.97ms]
1578 |           headerTemplate: (key: string) => `<div class="header">${key}</div>`,
1579 |         },
1580 |       });
1581 | 
1582 |       // items property should return the original items (no headers)
1583 |       expect(vlist.items.length).toBe(8);
                                        ^
error: expect(received).toBe(expected)

Expected: 8
Received: 11

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1583:34)
(fail) createVList groups mode > initialization > should return original items without headers via items property [1.87ms]
1602 |         { id: 11, name: "Grape", category: "Fruits" },
1603 |       ];
1604 |       groupsCfg._updateItems(newItems);
1605 |       vlist.setItems(newItems);
1606 | 
1607 |       expect(vlist.total).toBe(2);
                                 ^
error: expect(received).toBe(expected)

Expected: 2
Received: 11

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1607:27)
(fail) createVList groups mode > data methods with groups > should setItems and rebuild group layout [1.76ms]
1622 |         { id: 21, name: "Tuna", category: "Fish" },
1623 |       ];
1624 |       groupsCfg._updateItems([...items, ...appended]);
1625 |       vlist.appendItems(appended);
1626 | 
1627 |       expect(vlist.total).toBe(10);
                                 ^
error: expect(received).toBe(expected)

Expected: 10
Received: 11

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1627:27)
(fail) createVList groups mode > data methods with groups > should appendItems and rebuild group layout [2.01ms]
1641 |         { id: 30, name: "Milk", category: "Dairy" },
1642 |       ];
1643 |       groupsCfg._updateItems([...prepended, ...items]);
1644 |       vlist.prependItems(prepended);
1645 | 
1646 |       expect(vlist.total).toBe(9);
                                 ^
error: expect(received).toBe(expected)

Expected: 9
Received: 11

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1646:27)
(fail) createVList groups mode > data methods with groups > should prependItems and rebuild group layout [2.88ms]
1657 |       });
1658 | 
1659 |       groupsCfg._updateItems(items.filter((i) => i.id !== 1));
1660 |       vlist.removeItem(1);
1661 | 
1662 |       expect(vlist.total).toBe(7);
                                 ^
error: expect(received).toBe(expected)

Expected: 7
Received: 11

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1662:27)
(fail) createVList groups mode > data methods with groups > should removeItem and rebuild group layout [3.30ms]
(pass) createVList groups mode > scroll snapshot with groups > should get scroll snapshot in groups mode [1.37ms]
(pass) createVList groups mode > scroll snapshot with groups > should restore scroll in groups mode [2.21ms]
(pass) createVList groups mode > destroy > should clean up grouped vlist with sticky header [0.40ms]
(pass) createVList window scroll mode > should create vlist in window scroll mode [3.20ms]
(pass) createVList window scroll mode > should render items in window scroll mode [2.05ms]
(pass) createVList window scroll mode > should handle scroll methods in window mode [2.03ms]
(pass) createVList window scroll mode > should handle snapshot in window mode [2.08ms]
(pass) createVList window scroll mode > should clean up window event listeners on destroy [2.40ms]
1863 |     });
1864 | 
1865 |     // Wait for initial load
1866 |     await new Promise((r) => setTimeout(r, 50));
1867 | 
1868 |     expect(vlist.total).toBeGreaterThan(0);
                               ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1868:25)
(fail) createVList adapter reload > should reload data from adapter [55.59ms]
(pass) createVList adapter reload > should emit load events on adapter operations [53.85ms]
(pass) createVList reverse mode > should create vlist in reverse mode [3.93ms]
1950 |     vlist.appendItems([
1951 |       { id: 100, name: "New Message 1", value: 100 },
1952 |       { id: 101, name: "New Message 2", value: 101 },
1953 |     ]);
1954 | 
1955 |     expect(vlist.total).toBe(22);
                               ^
error: expect(received).toBe(expected)

Expected: 22
Received: 20

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1955:25)
(fail) createVList reverse mode > should append items and auto-scroll in reverse mode [3.93ms]
1968 |     vlist.prependItems([
1969 |       { id: 200, name: "Old Message 1", value: 200 },
1970 |       { id: 201, name: "Old Message 2", value: 201 },
1971 |     ]);
1972 | 
1973 |     expect(vlist.total).toBe(22);
                               ^
error: expect(received).toBe(expected)

Expected: 22
Received: 20

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:1973:25)
(fail) createVList reverse mode > should prepend items and preserve scroll in reverse mode [3.86ms]
(pass) createVList scroll snapshot > should get and restore scroll snapshot [1.78ms]
(pass) createVList scroll snapshot > should have snapshot methods [1.38ms]
(pass) createVList scroll snapshot > should handle snapshot with variable heights [1.21ms]
(pass) createVList compression > should enable compression for very large lists [42.78ms]
2087 | 
2088 |     expect(vlist.total).toBe(100);
2089 | 
2090 |     // Add enough items to trigger compression
2091 |     vlist.setItems(createTestItems(500_000));
2092 |     expect(vlist.total).toBe(500_000);
                               ^
error: expect(received).toBe(expected)

Expected: 500000
Received: 100

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2092:25)
(fail) createVList compression > should transition from uncompressed to compressed when items grow [42.85ms]
(pass) createVList compression > should handle scrollToIndex in compressed mode [47.48ms]
(pass) createVList compression > should render items near the target index after scrollToIndex in compressed mode [50.03ms]
(pass) createVList selection advanced > should handle single selection mode [3.24ms]
(pass) createVList selection advanced > should get selected items [2.33ms]
(pass) horizontal vlist integration > should handle horizontal mode with large item count [1.54ms]
2279 |       layout: "grid",
2280 |       grid: { columns: 4 },
2281 |     });
2282 | 
2283 |     expect(vlist).toBeDefined();
2284 |     expect(vlist.total).toBe(2_000_000);
                               ^
error: expect(received).toBe(expected)

Expected: 2000000
Received: 500000

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2284:25)
(fail) grid mode with compression integration > should handle compressed grid with scrollToIndex [307.82ms]
2302 |       grid: { columns: 4 },
2303 |     });
2304 | 
2305 |     // Start small, grow to compression
2306 |     vlist.setItems(createTestItems(2_000_000));
2307 |     expect(vlist.total).toBe(2_000_000);
                               ^
error: expect(received).toBe(expected)

Expected: 2000000
Received: 25

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2307:25)
(fail) grid mode with compression integration > should handle grid compression transitions [309.16ms]
(pass) vlist — horizontal mode > should create horizontal list and render items [2.12ms]
(pass) vlist — horizontal mode > should handle horizontal mode with scrollToIndex [1.64ms]
(pass) vlist — grid scroll snapshot > should get and restore scroll snapshot in grid mode [5.85ms]
(pass) vlist — grid scroll snapshot > should get and restore snapshot in non-grid mode [2.48ms]
(pass) vlist — groups data mutation methods > should appendItems in group mode and rebuild layout [2.65ms]
2495 |     list.prependItems([
2496 |       { id: 1, name: "A1", category: "A" },
2497 |       { id: 2, name: "A2", category: "A" },
2498 |     ]);
2499 | 
2500 |     expect(list.items.length).toBe(4);
                                     ^
error: expect(received).toBe(expected)

Expected: 4
Received: 3

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2500:31)
      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2474:62)
(fail) vlist — groups data mutation methods > should prependItems in group mode and rebuild layout [2.09ms]
2521 |         headerTemplate: (group) => `<strong>${group}</strong>`,
2522 |       },
2523 |     });
2524 | 
2525 |     list.removeItem(2);
2526 |     expect(list.items.length).toBe(2);
                                     ^
error: expect(received).toBe(expected)

Expected: 2
Received: 5

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2526:31)
      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2503:60)
(fail) vlist — groups data mutation methods > should removeItem in group mode and rebuild layout [1.64ms]
2555 |       reverse: true,
2556 |     });
2557 | 
2558 |     // Append items — the reverse-mode appendItems wrapper should handle auto-scrolling
2559 |     list.appendItems(createTestItems(5, 21));
2560 |     expect(list.total).toBe(25);
                              ^
error: expect(received).toBe(expected)

Expected: 25
Received: 20

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2560:24)
      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2546:74)
(fail) vlist — reverse mode data methods > should auto-scroll on appendItems in reverse mode when at bottom [2.85ms]
2572 |       reverse: true,
2573 |     });
2574 | 
2575 |     // Prepend items — should preserve scroll position
2576 |     list.prependItems(createTestItems(5, 100));
2577 |     expect(list.total).toBe(25);
                              ^
error: expect(received).toBe(expected)

Expected: 25
Received: 20

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2577:24)
      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2563:73)
(fail) vlist — reverse mode data methods > should preserve scroll position on prependItems in reverse mode [3.29ms]
2629 | 
2630 |     // Use options object
2631 |     list.scrollToIndex(3, { align: "center", behavior: "auto" });
2632 | 
2633 |     // Should not throw
2634 |     expect(list.total).toBe(5);
                              ^
error: expect(received).toBe(expected)

Expected: 5
Received: 8

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2634:24)
      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2597:74)
(fail) vlist — groups scrollToIndex with ScrollToOptions > should accept ScrollToOptions object in group mode scrollToIndex [2.56ms]
(pass) vlist — selection API methods > should use all selection methods: select, deselect, toggleSelect, selectAll, clearSelection [3.28ms]
(pass) vlist — on/off event methods > should subscribe and unsubscribe using on/off [1.89ms]
2780 |         headerTemplate: (group) => `<strong>${group}</strong>`,
2781 |       },
2782 |     });
2783 | 
2784 |     // .items should return original items, not layout items with headers
2785 |     expect(list.items.length).toBe(2);
                                     ^
error: expect(received).toBe(expected)

Expected: 2
Received: 4

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2785:31)
      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2757:75)
(fail) vlist — items and total getters in group mode > should return original items (without headers) from .items getter [1.42ms]
2817 |       layout: "grid",
2818 |       grid: { columns: 4 },
2819 |     });
2820 | 
2821 |     // .total should be 24 (not 6 rows)
2822 |     expect(list.total).toBe(24);
                              ^
error: expect(received).toBe(expected)

Expected: 24
Received: 6

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2822:24)
      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2808:64)
(fail) vlist — grid mode total getter > should return flat item count from .total in grid mode [3.84ms]
(pass) vlist — destroy idempotent > should not throw when destroy is called twice [1.75ms]
2849 |     expect(() =>
2850 |       createVList({
2851 |         container: null as any,
2852 |         item: { height: 40, template: () => "" },
2853 |       }),
2854 |     ).toThrow("[vlist] Container is required");
             ^
error: expect(received).toThrow(expected)

Expected substring: "[vlist] Container is required"
Received message: "[vlist/builder] Container is required"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2854:7)
      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2848:49)
(fail) vlist — validation > should throw when no container provided [0.07ms]
2859 |     expect(() =>
2860 |       createVList({
2861 |         container,
2862 |         item: undefined as any,
2863 |       }),
2864 |     ).toThrow("[vlist] item configuration is required");
             ^
error: expect(received).toThrow(expected)

Expected substring: "[vlist] item configuration is required"
Received message: "[vlist/builder] item configuration is required"

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2864:7)
      at <anonymous> (/Users/jvial/Code/floor/vlist/test/integration.test.ts:2857:51)
(fail) vlist — validation > should throw when no item config provided [0.18ms]
(pass) vlist — wrap mode > should create list with wrap mode enabled [1.48ms]
(pass) vlist — variable height function > should handle function-based heights [1.91ms]

test/scroll/scrollbar.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '../../src/scroll/scrollbar' from '/Users/jvial/Code/floor/vlist/test/scroll/scrollbar.test.ts'
-------------------------------


test/scroll/controller.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '../../src/scroll' from '/Users/jvial/Code/floor/vlist/test/scroll/controller.test.ts'
-------------------------------


test/render/compression.test.ts:
(pass) MAX_VIRTUAL_HEIGHT > should be 16 million pixels
(pass) getCompressionState > should not compress small lists [0.05ms]
(pass) getCompressionState > should compress lists exceeding MAX_VIRTUAL_HEIGHT [0.05ms]
(pass) getCompressionState > should handle edge case at exactly MAX_VIRTUAL_HEIGHT [0.02ms]
(pass) getCompressionState > should handle zero items [0.02ms]
(pass) getCompressionState > should handle very large lists (10M items) [0.02ms]
(pass) calculateCompressedVisibleRange > without compression > should calculate correct range at scroll position 0 [0.02ms]
(pass) calculateCompressedVisibleRange > without compression > should calculate correct range when scrolled [0.05ms]
(pass) calculateCompressedVisibleRange > with compression > should map scroll position to correct item range [0.02ms]
(pass) calculateCompressedVisibleRange > with compression > should handle near-bottom interpolation [0.03ms]
(pass) calculateCompressedVisibleRange > with compression > should never exceed totalItems - 1 [0.02ms]
(pass) calculateCompressedVisibleRange > should handle empty list [0.02ms]
(pass) calculateCompressedRenderRange > should add overscan to visible range [0.02ms]
(pass) calculateCompressedRenderRange > should clamp start to 0 [0.05ms]
(pass) calculateCompressedRenderRange > should clamp end to totalItems - 1 [0.01ms]
(pass) calculateCompressedRenderRange > should handle empty list [0.01ms]
(pass) calculateCompressedItemPosition > without compression > should calculate absolute position in content space [0.01ms]
(pass) calculateCompressedItemPosition > without compression > should use absolute positioning (scroll handled by container) [0.02ms]
(pass) calculateCompressedItemPosition > with compression > should position items relative to virtual scroll index [0.02ms]
(pass) calculateCompressedItemPosition > with compression > should position consecutive items with full item height spacing [0.02ms]
(pass) calculateCompressedItemPosition > with compression > should handle near-bottom positioning [0.03ms]
(pass) calculateCompressedScrollToIndex > without compression > should scroll to start alignment [0.02ms]
(pass) calculateCompressedScrollToIndex > without compression > should scroll to center alignment [0.01ms]
(pass) calculateCompressedScrollToIndex > without compression > should scroll to end alignment [0.02ms]
(pass) calculateCompressedScrollToIndex > with compression > should map index to compressed scroll position [0.01ms]
(pass) calculateCompressedScrollToIndex > with compression > should clamp to valid scroll range [0.01ms]
(pass) calculateCompressedScrollToIndex > with compression > should handle first item [0.01ms]
(pass) calculateCompressedScrollToIndex > should handle empty list [0.01ms]
(pass) calculateIndexFromScrollPosition > without compression > should calculate index from scroll position [0.01ms]
(pass) calculateIndexFromScrollPosition > with compression > should calculate index from compressed scroll position [0.03ms]
(pass) calculateIndexFromScrollPosition > with compression > should handle scroll at start [0.01ms]
(pass) calculateIndexFromScrollPosition > with compression > should handle scroll at end [0.01ms]
(pass) calculateIndexFromScrollPosition > should handle empty list [0.01ms]
(pass) needsCompression > should return false for small lists [0.01ms]
(pass) needsCompression > should return true for large lists [0.03ms]
(pass) needsCompression > should consider item height
(pass) needsCompression > should work with HeightCache [0.01ms]
(pass) getMaxItemsWithoutCompression > should calculate max items for given height [0.02ms]
(pass) getMaxItemsWithoutCompression > should handle edge cases [0.02ms]
(pass) getCompressionInfo > should describe non-compressed list [0.02ms]
(pass) getCompressionInfo > should describe compressed list [0.05ms]
(pass) Compression Integration > should maintain scroll position consistency [0.03ms]
(pass) Compression Integration > should position visible items correctly in viewport [0.02ms]
(pass) Compression Integration > should reach the end of very large lists [0.02ms]
(pass) Compression with variable heights > should work with variable heights in non-compressed mode [0.11ms]
(pass) Compression with variable heights > should calculate correct visible range with variable heights [0.06ms]
(pass) Compression with variable heights > should position variable height items correctly [0.04ms]
(pass) Compression with variable heights > should scroll to correct offset for variable height items [0.03ms]
(pass) Compression with variable heights > should use correct item height for center alignment [0.03ms]
(pass) Compression with variable heights > should find correct index from scroll position with variable heights [0.05ms]

test/render/renderer.test.ts:
(pass) renderer getElement and pool stats > should return element for a rendered index via getElement [2.60ms]
(pass) renderer getElement and pool stats > should return undefined from getElement after clear [0.38ms]
(pass) renderer getElement and pool stats > should return undefined for index that scrolled out of range [1.67ms]
(pass) renderer getElement and pool stats > should reuse pooled elements when range shifts [2.17ms]
(pass) renderer updateItem and updateItemClasses > should updateItemClasses on a rendered item [0.33ms]
(pass) renderer updateItem and updateItemClasses > should updateItem with new data [0.59ms]
(pass) renderer updateItem and updateItemClasses > should handle template returning HTMLElement [0.34ms]
(pass) render/renderer — element pool overflow (L144-147) > should discard element when pool is at max capacity [0.10ms]
(pass) render/renderer — element pool overflow (L144-147) > should still clean attributes on elements that fit in pool [0.12ms]
(pass) render/renderer — element pool overflow (L144-147) > should handle pool clear correctly [0.13ms]
(pass) renderer — aria-setsize update when total changes between renders > should update aria-setsize on existing elements when total items changes [0.27ms]
(pass) renderer — re-apply template when item ID changes at same index > should re-apply template when item at index changes identity [0.68ms]
(pass) resolveContainer > should throw when string selector does not match any element [0.30ms]
(pass) resolveContainer > should return the element when string selector matches [0.14ms]
(pass) resolveContainer > should return the element directly when passed an HTMLElement [0.03ms]

test/render/heights.test.ts:
(pass) createHeightCache (fixed) > should create a fixed height cache from a number
(pass) createHeightCache (fixed) > should return correct total item count [0.06ms]
(pass) createHeightCache (fixed) > getOffset > should return 0 for first item [0.01ms]
(pass) createHeightCache (fixed) > getOffset > should calculate offset using multiplication
(pass) createHeightCache (fixed) > getOffset > should handle large indices
(pass) createHeightCache (fixed) > getHeight > should return fixed height for any index
(pass) createHeightCache (fixed) > indexAtOffset > should return 0 for offset 0
(pass) createHeightCache (fixed) > indexAtOffset > should calculate index using division [0.03ms]
(pass) createHeightCache (fixed) > indexAtOffset > should floor partial items
(pass) createHeightCache (fixed) > indexAtOffset > should clamp to 0 for negative offsets [0.02ms]
(pass) createHeightCache (fixed) > indexAtOffset > should clamp to last index for large offsets [0.01ms]
(pass) createHeightCache (fixed) > indexAtOffset > should return 0 for empty list
(pass) createHeightCache (fixed) > indexAtOffset > should handle exact boundary offsets
(pass) createHeightCache (fixed) > getTotalHeight > should return total * height
(pass) createHeightCache (fixed) > getTotalHeight > should return 0 for empty list [0.02ms]
(pass) createHeightCache (fixed) > rebuild > should update total after rebuild [0.01ms]
(pass) createHeightCache (fixed) > rebuild > should handle rebuild to 0 [0.02ms]
(pass) createHeightCache (variable) > should create a variable height cache from a function [0.01ms]
(pass) createHeightCache (variable) > should return correct total item count [0.03ms]
(pass) createHeightCache (variable) > getOffset > should return 0 for first item [0.02ms]
(pass) createHeightCache (variable) > getOffset > should compute prefix sum offsets correctly [0.02ms]
(pass) createHeightCache (variable) > getOffset > should handle header + items pattern [0.02ms]
(pass) createHeightCache (variable) > getOffset > should clamp for index <= 0 [0.02ms]
(pass) createHeightCache (variable) > getOffset > should return total height for index >= total
(pass) createHeightCache (variable) > getHeight > should return correct height for each index [0.01ms]
(pass) createHeightCache (variable) > getHeight > should delegate to the height function [0.01ms]
(pass) createHeightCache (variable) > indexAtOffset > should return 0 for offset 0 [0.01ms]
(pass) createHeightCache (variable) > indexAtOffset > should find correct item via binary search
(pass) createHeightCache (variable) > indexAtOffset > should handle offset within items (not on boundary) [0.04ms]
(pass) createHeightCache (variable) > indexAtOffset > should return 0 for negative offsets [0.01ms]
(pass) createHeightCache (variable) > indexAtOffset > should return last index for offsets beyond total height [0.01ms]
(pass) createHeightCache (variable) > indexAtOffset > should return 0 for empty list
(pass) createHeightCache (variable) > indexAtOffset > should handle single item [0.01ms]
(pass) createHeightCache (variable) > indexAtOffset > should handle exact boundary between items [0.01ms]
(pass) createHeightCache (variable) > getTotalHeight > should return sum of all heights [0.02ms]
(pass) createHeightCache (variable) > getTotalHeight > should return 0 for empty list
(pass) createHeightCache (variable) > getTotalHeight > should handle header pattern
(pass) createHeightCache (variable) > rebuild > should rebuild prefix sums with new total [0.02ms]
(pass) createHeightCache (variable) > rebuild > should handle rebuild to 0 [0.02ms]
(pass) createHeightCache (variable) > rebuild > should maintain correct offsets after rebuild [0.01ms]
(pass) createHeightCache (variable) > rebuild > should maintain correct binary search after rebuild [0.02ms]
(pass) Fixed vs Variable consistency > should have same isVariable results [0.02ms]
(pass) Fixed vs Variable consistency > should produce same offsets [0.01ms]
(pass) Fixed vs Variable consistency > should produce same heights [0.03ms]
(pass) Fixed vs Variable consistency > should produce same indexAtOffset results [0.03ms]
(pass) Fixed vs Variable consistency > should produce same total height [0.01ms]
(pass) Fixed vs Variable consistency > should produce same total count
(pass) countVisibleItems > fixed heights > should calculate using ceil division [0.01ms]
(pass) countVisibleItems > fixed heights > should ceil for partial items
(pass) countVisibleItems > fixed heights > should return 0 for empty list
(pass) countVisibleItems > variable heights > should count items that fit in container [0.02ms]
(pass) countVisibleItems > variable heights > should start counting from given index [0.01ms]
(pass) countVisibleItems > variable heights > should not exceed total items [0.03ms]
(pass) countVisibleItems > variable heights > should return at least 1 for non-empty list [0.02ms]
(pass) countVisibleItems > variable heights > should return 0 for empty list [0.01ms]
(pass) countItemsFittingFromBottom > fixed heights > should calculate using floor division [0.01ms]
(pass) countItemsFittingFromBottom > fixed heights > should floor for partial items [0.01ms]
(pass) countItemsFittingFromBottom > fixed heights > should return 0 for empty list
(pass) countItemsFittingFromBottom > variable heights > should count items from the bottom that fit [0.02ms]
(pass) countItemsFittingFromBottom > variable heights > should handle all items fitting [0.02ms]
(pass) countItemsFittingFromBottom > variable heights > should return at least 1 for non-empty list [0.01ms]
(pass) countItemsFittingFromBottom > variable heights > should return 0 for empty list [0.01ms]
(pass) getOffsetForVirtualIndex > fixed heights > should return integer index * height for integer indices
(pass) getOffsetForVirtualIndex > fixed heights > should interpolate for fractional indices [0.02ms]
(pass) getOffsetForVirtualIndex > fixed heights > should return 0 for index 0 [0.01ms]
(pass) getOffsetForVirtualIndex > fixed heights > should return 0 for empty list
(pass) getOffsetForVirtualIndex > variable heights > should return correct offset for integer index
(pass) getOffsetForVirtualIndex > variable heights > should interpolate for fractional indices [0.02ms]
(pass) getOffsetForVirtualIndex > variable heights > should interpolate correctly for fractional into large item
(pass) getOffsetForVirtualIndex > variable heights > should return 0 for index 0 [0.01ms]
(pass) getOffsetForVirtualIndex > variable heights > should clamp to valid range for large index [0.02ms]
(pass) getOffsetForVirtualIndex > variable heights > should return 0 for empty list [0.01ms]
(pass) getOffsetForVirtualIndex > consistency with fixed heights > should match index * height for fixed caches [0.01ms]
(pass) getOffsetForVirtualIndex > consistency with fixed heights > should match for uniform variable heights [0.04ms]
(pass) Edge cases > should handle single item list (fixed) [0.02ms]
(pass) Edge cases > should handle single item list (variable) [0.03ms]
(pass) Edge cases > should handle very large item counts (fixed) [0.01ms]
(pass) Edge cases > should handle variable heights with all same value [0.05ms]
(pass) Edge cases > should handle variable heights with extreme variation [0.03ms]
(pass) Edge cases > should correctly rebuild variable cache multiple times [0.04ms]
(pass) Binary search correctness > should find correct index for every offset in a small list [0.03ms]
(pass) Binary search correctness > should be consistent: indexAtOffset(getOffset(i)) === i [0.15ms]
(pass) Binary search correctness > should be consistent: getOffset(indexAtOffset(y)) <= y [0.29ms]

test/render/virtual.test.ts:
(pass) simpleVisibleRange > should return empty range when totalItems is 0
(pass) simpleVisibleRange > should return empty range when containerHeight is 0 [0.31ms]
(pass) simpleVisibleRange > should calculate correct range at scroll position 0 [0.03ms]
(pass) simpleVisibleRange > should calculate correct range when scrolled [0.01ms]
(pass) simpleVisibleRange > should clamp end to totalItems - 1 [0.02ms]
(pass) simpleVisibleRange > should handle partial items [0.01ms]
(pass) simpleVisibleRange > should never return negative start [0.01ms]
(pass) calculateRenderRange > should return empty range when totalItems is 0 [0.01ms]
(pass) calculateRenderRange > should add overscan to visible range [0.01ms]
(pass) calculateRenderRange > should clamp start to 0 [0.01ms]
(pass) calculateRenderRange > should clamp end to totalItems - 1
(pass) calculateRenderRange > should handle zero overscan [0.01ms]
(pass) calculateTotalHeight > should calculate total height correctly [0.01ms]
(pass) calculateTotalHeight > should return 0 for 0 items [0.02ms]
(pass) calculateTotalHeight > should handle large numbers
(pass) calculateItemOffset > should calculate offset for first item [0.01ms]
(pass) calculateItemOffset > should calculate offset correctly [0.01ms]
(pass) calculateItemOffset > should handle large indices
(pass) calculateActualHeight > should return the raw total height from height cache
(pass) calculateActualHeight > should return 0 for 0 items [0.01ms]
(pass) calculateActualHeight > should return actual height even for very large lists [0.01ms]
(pass) calculateActualHeight > should return actual height with variable heights [0.01ms]
(pass) calculateActualHeight > should ignore the totalItems parameter (uses cache only)
(pass) calculateScrollToIndex > should scroll to start alignment
(pass) calculateScrollToIndex > should scroll to center alignment [0.03ms]
(pass) calculateScrollToIndex > should scroll to end alignment [0.01ms]
(pass) calculateScrollToIndex > should default to start alignment
(pass) calculateScrollToIndex > should handle compressed lists (1M+ items) [0.02ms]
(pass) clampScrollPosition > should clamp negative values to 0 [0.03ms]
(pass) clampScrollPosition > should clamp values exceeding max scroll
(pass) clampScrollPosition > should not modify values within range [0.01ms]
(pass) clampScrollPosition > should handle edge case where content is smaller than container
(pass) getScrollDirection > should return down when scrolling down [0.01ms]
(pass) getScrollDirection > should return up when scrolling up
(pass) getScrollDirection > should return down when position unchanged
(pass) createViewportState > should create initial viewport state [0.07ms]
(pass) createViewportState > should include overscan in render range [0.02ms]
(pass) createViewportState > should handle empty list [0.01ms]
(pass) updateViewportState > should update state after scroll [0.02ms]
(pass) updateViewportState > should preserve containerHeight [0.03ms]
(pass) updateViewportSize > should update container height in state [0.02ms]
(pass) updateViewportSize > should recalculate visible range for new container size [0.03ms]
(pass) updateViewportSize > should update total height and compression fields [0.11ms]
(pass) updateViewportSize > should preserve scroll position when resizing [0.03ms]
(pass) updateViewportSize > should handle resize to very small container [0.02ms]
(pass) updateViewportSize > should handle resize with variable heights [0.05ms]
(pass) updateViewportSize > should mutate state in place for performance [0.02ms]
(pass) updateViewportSize > should handle resize with empty list [0.02ms]
(pass) updateViewportItems > should update total height when items change [0.02ms]
(pass) updateViewportItems > should recalculate visible range [0.02ms]
(pass) rangesEqual > should return true for equal ranges [0.02ms]
(pass) rangesEqual > should return false for different starts [0.01ms]
(pass) rangesEqual > should return false for different ends
(pass) isInRange > should return true for index within range [0.02ms]
(pass) isInRange > should return true for index at start
(pass) isInRange > should return true for index at end [0.01ms]
(pass) isInRange > should return false for index before range
(pass) isInRange > should return false for index after range
(pass) getRangeCount > should return correct count [0.01ms]
(pass) getRangeCount > should return 1 for single item range [0.01ms]
(pass) getRangeCount > should return 0 for invalid range
(pass) rangeToIndices > should create array of indices for a range [0.01ms]
(pass) rangeToIndices > should return single element for same start and end [0.04ms]
(pass) rangeToIndices > should return empty array for invalid range [0.01ms]
(pass) rangeToIndices > should handle range starting at 0 [0.01ms]
(pass) rangeToIndices > should handle large range [0.07ms]
(pass) diffRanges > should find indices to add when scrolling down [0.05ms]
(pass) diffRanges > should find indices to add when scrolling up [0.03ms]
(pass) diffRanges > should return empty arrays for identical ranges [0.02ms]
(pass) diffRanges > should handle non-overlapping ranges
(pass) Variable height support > calculateTotalHeight with variable heights > should return correct virtual height [0.04ms]
(pass) Variable height support > calculateItemOffset with variable heights > should return prefix-sum based offsets [0.02ms]
(pass) Variable height support > createViewportState with variable heights > should create correct initial state [0.04ms]
(pass) Variable height support > createViewportState with variable heights > should calculate correct visible range with variable heights [0.02ms]
(pass) Variable height support > updateViewportState with variable heights > should update correctly after scroll [0.02ms]
(pass) Variable height support > calculateScrollToIndex with variable heights > should scroll to correct offset for variable height items [0.02ms]
(pass) Variable height support > calculateScrollToIndex with variable heights > should center correctly for variable height items [0.02ms]
(pass) Variable height support > calculateScrollToIndex with variable heights > should end-align correctly for variable height items [0.01ms]

test/groups/sticky.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '../../src/groups/sticky' from '/Users/jvial/Code/floor/vlist/test/groups/sticky.test.ts'
-------------------------------


test/groups/layout.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '../../src/groups/layout' from '/Users/jvial/Code/floor/vlist/test/groups/layout.test.ts'
-------------------------------


test/adapters/svelte.test.ts:
(pass) vlist Svelte action > lifecycle > should create a vlist instance on the provided node [7.13ms]
(pass) vlist Svelte action > lifecycle > should return an object with update and destroy methods [4.21ms]
(pass) vlist Svelte action > lifecycle > should clean up DOM on destroy [3.59ms]
(pass) vlist Svelte action > onInstance callback > should call onInstance with the vlist instance on mount [3.36ms]
(pass) vlist Svelte action > onInstance callback > should provide a working instance via onInstance [3.16ms]
(pass) vlist Svelte action > onInstance callback > should call onInstance again on update if provided [3.81ms]
268 |       const newItems = createItems(25);
269 |       action.update?.({
270 |         config: createConfig(newItems),
271 |       });
272 | 
273 |       expect(instance!.total).toBe(25);
                                    ^
error: expect(received).toBe(expected)

Expected: 25
Received: 10

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/adapters/svelte.test.ts:273:31)
(fail) vlist Svelte action > update > should update items when update is called with new items [3.73ms]
292 | 
293 |       action.update?.({
294 |         config: createConfig([]),
295 |       });
296 | 
297 |       expect(instance!.total).toBe(0);
                                    ^
error: expect(received).toBe(expected)

Expected: 0
Received: 10

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/adapters/svelte.test.ts:297:31)
(fail) vlist Svelte action > update > should handle update with empty items [3.10ms]
315 |       for (let i = 1; i <= 5; i++) {
316 |         const count = i * 10;
317 |         action.update?.({
318 |           config: createConfig(createItems(count)),
319 |         });
320 |         expect(instance!.total).toBe(count);
                                      ^
error: expect(received).toBe(expected)

Expected: 10
Received: 5

      at <anonymous> (/Users/jvial/Code/floor/vlist/test/adapters/svelte.test.ts:320:33)
(fail) vlist Svelte action > update > should handle multiple sequential updates [4.05ms]
(pass) vlist Svelte action > update > should not break when update has no items [3.36ms]
(pass) vlist Svelte action > instance methods > should allow scrollToIndex through instance [3.98ms]
(pass) vlist Svelte action > instance methods > should allow getSelected through instance with selection mode [4.84ms]
(pass) vlist Svelte action > onVListEvent > should subscribe to events and return an unsubscribe function [4.59ms]
(pass) vlist Svelte action > onVListEvent > should return a callable unsubscribe even for valid events [4.19ms]
(pass) vlist Svelte action > edge cases > should handle action with zero items [3.62ms]
(pass) vlist Svelte action > edge cases > should handle large item count [4.53ms]
(pass) vlist Svelte action > edge cases > should work without onInstance callback [3.59ms]
(pass) vlist Svelte action > edge cases > should handle variable height items [3.43ms]

test/selection/index.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '../../src/selection' from '/Users/jvial/Code/floor/vlist/test/selection/index.test.ts'
-------------------------------


test/events/index.test.ts:
(pass) createEmitter > should create an emitter instance
(pass) on / emit > should call handler when event is emitted [0.05ms]
(pass) on / emit > should call multiple handlers for same event [0.12ms]
(pass) on / emit > should not call handlers for different events [0.03ms]
(pass) on / emit > should handle events with no listeners [0.02ms]
(pass) on / emit > should pass correct payload to handler [0.02ms]
(pass) off > should remove handler [0.03ms]
(pass) off > should only remove specified handler [0.03ms]
(pass) off > should handle removing non-existent handler [0.02ms]
(pass) unsubscribe function > should return unsubscribe function from on() [0.01ms]
(pass) unsubscribe function > should unsubscribe when called [0.03ms]
(pass) once > should call handler only once [0.05ms]
(pass) once > should return unsubscribe function
(pass) clear > should clear all listeners for specific event [0.03ms]
(pass) clear > should clear all listeners when no event specified [0.06ms]
(pass) listenerCount > should return correct listener count [0.02ms]
(pass) listenerCount > should return 0 for events with no listeners [0.01ms]
(pass) listenerCount > should update after removing listeners
(pass) error handling > should continue calling handlers if one throws [0.07ms]
(pass) error handling > should log error when handler throws [0.05ms]
(pass) type safety > should enforce correct payload types [0.03ms]
(pass) multiple emitter instances > should maintain separate state for each instance

test/data/index.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '../../src/data' from '/Users/jvial/Code/floor/vlist/test/data/index.test.ts'
-------------------------------


test/data/placeholder.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '../../src/data/placeholder' from '/Users/jvial/Code/floor/vlist/test/data/placeholder.test.ts'
-------------------------------


test/data/sparse.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '../../src/data/sparse' from '/Users/jvial/Code/floor/vlist/test/data/sparse.test.ts'
-------------------------------


test/grid/renderer.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '../../src/grid/renderer' from '/Users/jvial/Code/floor/vlist/test/grid/renderer.test.ts'
-------------------------------


test/grid/layout.test.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '../../src/grid/layout' from '/Users/jvial/Code/floor/vlist/test/grid/layout.test.ts'
-------------------------------


110 tests failed:
(fail) reverse mode > validation > should throw when combined with groups [1.81ms]
(fail) reverse mode > validation > should throw when combined with grid layout [0.24ms]
(fail) reverse mode > appendItems auto-scroll > should auto-scroll to bottom when appending and user was at bottom [7.33ms]
(fail) reverse mode > appendItems auto-scroll > should append multiple messages and keep scrolling to bottom [10.08ms]
(fail) reverse mode > appendItems auto-scroll > should not crash when appending to empty list in reverse mode [7.63ms]
(fail) reverse mode > prependItems scroll preservation > should preserve scroll position when prepending items [7.20ms]
(fail) reverse mode > prependItems scroll preservation > should handle prepending to an empty list [2.98ms]
(fail) reverse mode > prependItems scroll preservation > should handle multiple sequential prepends [9.33ms]
(fail) reverse mode > prependItems scroll preservation > should preserve scroll when prepending a single item [5.55ms]
(fail) reverse mode > setItems in reverse mode > should replace items and keep total correct [3.45ms]
(fail) reverse mode > setItems in reverse mode > should allow clearing and resetting items [3.50ms]
(fail) reverse mode > data methods > should support removeItem in reverse mode [6.69ms]
(fail) reverse mode > variable heights > should preserve scroll with variable heights on prepend [3.97ms]
(fail) reverse mode > edge cases > should handle rapid append/prepend operations [18.26ms]
(fail) reverse mode > non-reverse mode unaffected > should not auto-scroll appendItems without reverse [2.55ms]
(fail) reverse mode > non-reverse mode unaffected > should not adjust scroll on prependItems without reverse [3.12ms]
(fail) vlist grid gap with function height > should inflate function-based heights by grid gap [16.86ms]
(fail) vlist grid gap with function height > should inflate numeric heights by grid gap [4.90ms]
(fail) vlist grid gap with function height > should handle grid gap of 0 without modifying height function [4.86ms]
(fail) vlist window resize handler > should handle window resize in window scroll mode [3.64ms]
(fail) vlist compression mode transitions > should create custom scrollbar when entering compression with native mode [47.61ms]
(fail) vlist compression mode transitions > should transition from compressed to uncompressed when items shrink [46.59ms]
(fail) vlist compression mode transitions > should update compression when already compressed and total changes [182.54ms]
(fail) vlist compression mode transitions > should not create scrollbar on compression when mode is none [45.02ms]
(fail) vlist compression mode transitions > should create scrollbar on compression with default custom mode [43.90ms]
(fail) vlist sticky header wrapping > should create sticky header when groups.sticky is true [4.27ms]
(fail) vlist sticky header wrapping > should invoke wrappedHandleScroll via native scroll event on viewport [25.44ms]
(fail) vlist sticky header wrapping > should invoke wrappedHandleScroll with loadPendingRange forwarded [127.24ms]
(fail) vlist adapter initial load > should load initial data from adapter when no items provided [55.44ms]
(fail) vlist adapter initial load > should emit load:start and load:end events on adapter initial load [102.07ms]
(fail) vlist adapter initial load > should not call loadInitial when items are provided with adapter [59.70ms]
(fail) vlist reverse mode with adapter > should scroll to bottom after adapter load completes in reverse mode [106.68ms]
(fail) vlist compression scrollbar creation > should handle multiple compression/decompression cycles [45.32ms]
(fail) vlist compression scrollbar creation > should update scrollbar bounds when compression state changes [154.31ms]
(fail) vlist window mode compression sync > should sync maxScroll in window mode even without compression [4.11ms]
(fail) vlist window mode compression sync > should sync maxScroll in window mode with compression [86.24ms]
(fail) vlist additional edge cases > should handle grid mode with variable height function and gap [7.10ms]
(fail) vlist additional edge cases > should handle groups with setItems rebuilding layout and then scrollToIndex [2.69ms]
(fail) vlist additional edge cases > should handle window mode with native scrollbar and items change [4.22ms]
(fail) live region > should announce single selection [3.92ms]
(fail) live region > should announce multiple selections [3.97ms]
(fail) live region > should clear announcement when selection is cleared [3.71ms]
(fail) live region > should update announcement as selection changes [3.16ms]
(fail) keyboard navigation ARIA integration > should update both aria-activedescendant and selection announcement on Space [4.29ms]
(fail) createVList > initialization > should throw error without container [0.47ms]
(fail) createVList > initialization > should throw error without item config [0.05ms]
(fail) createVList > initialization > should throw error without item.height [0.07ms]
(fail) createVList > initialization > should throw error without item.template [0.03ms]
(fail) createVList > data methods > should set items [2.10ms]
(fail) createVList > data methods > should append items [2.43ms]
(fail) createVList > data methods > should remove item [2.31ms]
(fail) createVList with adapter > should work with async adapter [52.98ms]
(fail) createVList with adapter > should emit load events [104.17ms]
(fail) createVList edge cases > should work without selection config [1.59ms]
(fail) createVList horizontal direction > validation > should throw when direction is horizontal but item.width is missing [0.16ms]
(fail) createVList horizontal direction > validation > should throw when item.width is zero in horizontal mode [0.04ms]
(fail) createVList horizontal direction > validation > should throw when item.width is negative in horizontal mode [0.12ms]
(fail) createVList horizontal direction > validation > should throw when item.width is invalid type in horizontal mode [0.04ms]
(fail) createVList horizontal direction > validation > should throw when horizontal combined with groups [0.12ms]
(fail) createVList horizontal direction > validation > should throw when horizontal combined with grid layout [0.10ms]
(fail) createVList horizontal direction > DOM structure > should add --horizontal class to root [1.41ms]
(fail) createVList horizontal direction > DOM structure > should use custom class prefix with horizontal modifier [1.46ms]
(fail) createVList horizontal direction > DOM structure > should set overflowX on viewport instead of overflow [1.88ms]
(fail) createVList horizontal direction > DOM structure > should set content height to 100% and width to total scrollable width [1.49ms]
(fail) createVList horizontal direction > DOM structure > should set items container height to 100% [1.47ms]
(fail) createVList horizontal direction > data methods > should set items in horizontal mode [1.39ms]
(fail) createVList horizontal direction > data methods > should append items in horizontal mode [1.45ms]
(fail) createVList grid mode > validation > should throw when layout is grid but grid config is missing [0.85ms]
(fail) createVList grid mode > validation > should throw when grid.columns is 0 [0.09ms]
(fail) createVList grid mode > validation > should throw when grid is combined with groups [0.08ms]
(fail) createVList grid mode > initialization > should create a grid mode vlist [3.15ms]
(fail) createVList grid mode > initialization > should create grid with gap [3.19ms]
(fail) createVList grid mode > data methods > should set items in grid mode [4.74ms]
(fail) createVList grid mode > data methods > should append items in grid mode [2.86ms]
(fail) createVList grid mode > data methods > should remove item in grid mode [2.02ms]
(fail) createVList groups mode > initialization > should create a grouped vlist [1.97ms]
(fail) createVList groups mode > initialization > should return original items without headers via items property [1.87ms]
(fail) createVList groups mode > data methods with groups > should setItems and rebuild group layout [1.76ms]
(fail) createVList groups mode > data methods with groups > should appendItems and rebuild group layout [2.01ms]
(fail) createVList groups mode > data methods with groups > should prependItems and rebuild group layout [2.88ms]
(fail) createVList groups mode > data methods with groups > should removeItem and rebuild group layout [3.30ms]
(fail) createVList adapter reload > should reload data from adapter [55.59ms]
(fail) createVList reverse mode > should append items and auto-scroll in reverse mode [3.93ms]
(fail) createVList reverse mode > should prepend items and preserve scroll in reverse mode [3.86ms]
(fail) createVList compression > should transition from uncompressed to compressed when items grow [42.85ms]
(fail) grid mode with compression integration > should handle compressed grid with scrollToIndex [307.82ms]
(fail) grid mode with compression integration > should handle grid compression transitions [309.16ms]
(fail) vlist — groups data mutation methods > should prependItems in group mode and rebuild layout [2.09ms]
(fail) vlist — groups data mutation methods > should removeItem in group mode and rebuild layout [1.64ms]
(fail) vlist — reverse mode data methods > should auto-scroll on appendItems in reverse mode when at bottom [2.85ms]
(fail) vlist — reverse mode data methods > should preserve scroll position on prependItems in reverse mode [3.29ms]
(fail) vlist — groups scrollToIndex with ScrollToOptions > should accept ScrollToOptions object in group mode scrollToIndex [2.56ms]
(fail) vlist — items and total getters in group mode > should return original items (without headers) from .items getter [1.42ms]
(fail) vlist — grid mode total getter > should return flat item count from .total in grid mode [3.84ms]
(fail) vlist — validation > should throw when no container provided [0.07ms]
(fail) vlist — validation > should throw when no item config provided [0.18ms]
(fail) vlist Svelte action > update > should update items when update is called with new items [3.73ms]
(fail) vlist Svelte action > update > should handle update with empty items [3.10ms]
(fail) vlist Svelte action > update > should handle multiple sequential updates [4.05ms]

 646 pass
 110 fail
 11 errors
 3692 expect() calls
Ran 756 tests across 22 files. [5.77s]
