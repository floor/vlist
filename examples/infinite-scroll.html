<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>vlist - Infinite Scroll Example</title>
        <link rel="stylesheet" href="../dist/vlist.css" />
        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    Oxygen, Ubuntu, sans-serif;
                background: #f5f5f5;
                padding: 20px;
            }

            h1 {
                margin-bottom: 10px;
                color: #333;
            }

            .description {
                color: #666;
                margin-bottom: 20px;
            }

            .controls {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
                flex-wrap: wrap;
                align-items: center;
            }

            button {
                padding: 8px 16px;
                border: none;
                border-radius: 6px;
                background: #667eea;
                color: white;
                font-size: 14px;
                cursor: pointer;
                transition: background 0.2s;
            }

            button:hover {
                background: #5a6fd6;
            }

            label {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 14px;
                color: #555;
            }

            input[type="range"] {
                width: 100px;
            }

            .stats {
                background: #fff;
                padding: 12px 15px;
                border-radius: 8px;
                margin-bottom: 15px;
                font-size: 14px;
                display: flex;
                gap: 20px;
                flex-wrap: wrap;
            }

            .stat {
                display: flex;
                align-items: center;
                gap: 6px;
            }

            .stat-label {
                color: #888;
            }

            .stat-value {
                font-weight: 600;
                color: #333;
            }

            .stat-value.loading {
                color: #667eea;
            }

            #list-container {
                height: 500px;
                background: #fff;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                overflow: hidden;
            }

            .item-content {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 0 16px;
                height: 100%;
            }

            .item-image {
                width: 48px;
                height: 48px;
                border-radius: 8px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: 600;
                font-size: 18px;
                flex-shrink: 0;
            }

            .item-details {
                flex: 1;
                min-width: 0;
            }

            .item-title {
                font-weight: 500;
                color: #333;
                margin-bottom: 2px;
            }

            .item-subtitle {
                font-size: 13px;
                color: #888;
            }

            .item-meta {
                text-align: right;
                min-width: 80px;
            }

            .item-date {
                font-size: 12px;
                color: #aaa;
            }

            .item-status {
                font-size: 11px;
                padding: 2px 8px;
                border-radius: 10px;
                display: inline-block;
                margin-top: 4px;
            }

            .status-active {
                background: #d4edda;
                color: #155724;
            }

            .status-pending {
                background: #fff3cd;
                color: #856404;
            }

            .status-inactive {
                background: #f8d7da;
                color: #721c24;
            }

            /* Placeholder styles */
            .placeholder .item-image {
                background: #e0e0e0;
                animation: pulse 1.5s ease-in-out infinite;
            }

            .placeholder .item-title,
            .placeholder .item-subtitle,
            .placeholder .item-date {
                background: #e0e0e0;
                color: transparent;
                border-radius: 4px;
                animation: pulse 1.5s ease-in-out infinite;
            }

            .placeholder .item-status {
                display: none;
            }

            @keyframes pulse {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
            }

            .log {
                margin-top: 15px;
                padding: 12px;
                background: #1e1e1e;
                border-radius: 8px;
                font-family: "Monaco", "Menlo", monospace;
                font-size: 12px;
                color: #d4d4d4;
                max-height: 150px;
                overflow-y: auto;
            }

            .log-entry {
                margin-bottom: 4px;
            }

            .log-entry .time {
                color: #888;
            }

            .log-entry .event {
                color: #569cd6;
            }

            .log-entry .data {
                color: #ce9178;
            }
        </style>
    </head>
    <body>
        <h1>♾️ Infinite Scroll Example</h1>
        <p class="description">
            Scroll down to automatically load more items. Simulates API calls
            with configurable delay.
        </p>

        <div class="controls">
            <button id="reload">Reload Data</button>
            <button id="scroll-to-500">Jump to #500</button>
            <button id="scroll-to-end">Jump to End</button>
            <label>
                Simulated delay:
                <input
                    type="range"
                    id="delay"
                    min="0"
                    max="2000"
                    value="500"
                    step="100"
                />
                <span id="delay-value">500ms</span>
            </label>
        </div>

        <div class="stats">
            <div class="stat">
                <span class="stat-label">Loaded:</span>
                <span class="stat-value" id="loaded-count">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">Total:</span>
                <span class="stat-value" id="total-count">?</span>
            </div>
            <div class="stat">
                <span class="stat-label">Status:</span>
                <span class="stat-value" id="status">Ready</span>
            </div>
            <div class="stat">
                <span class="stat-label">DOM Elements:</span>
                <span class="stat-value" id="dom-count">0</span>
            </div>
        </div>

        <div id="list-container"></div>

        <div class="log" id="log"></div>

        <script type="module">
            import { createVList } from "../dist/index.js";

            // Simulated database
            const TOTAL_ITEMS = 10000;
            const statuses = ["active", "pending", "inactive"];

            const generateItem = (id) => ({
                id,
                title: `Item #${id}`,
                subtitle: `Description for item ${id} - Lorem ipsum dolor sit amet`,
                date: new Date(
                    Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000,
                ).toLocaleDateString(),
                status: statuses[id % 3],
                letter: String.fromCharCode(65 + (id % 26)),
            });

            // Simulated API
            let simulatedDelay = 500;

            const fetchItems = async (offset, limit) => {
                await new Promise((resolve) =>
                    setTimeout(resolve, simulatedDelay),
                );

                const items = [];
                const end = Math.min(offset + limit, TOTAL_ITEMS);

                for (let i = offset; i < end; i++) {
                    items.push(generateItem(i + 1));
                }

                return {
                    items,
                    total: TOTAL_ITEMS,
                    hasMore: end < TOTAL_ITEMS,
                };
            };

            // Logging
            const logContainer = document.getElementById("log");
            const log = (event, data) => {
                const time = new Date().toLocaleTimeString();
                const entry = document.createElement("div");
                entry.className = "log-entry";
                entry.innerHTML = `<span class="time">[${time}]</span> <span class="event">${event}</span> <span class="data">${data}</span>`;
                logContainer.insertBefore(entry, logContainer.firstChild);

                // Keep only last 20 entries
                while (logContainer.children.length > 20) {
                    logContainer.removeChild(logContainer.lastChild);
                }
            };

            // Create the virtual list with async adapter
            const list = createVList({
                container: "#list-container",
                itemHeight: 72,
                template: (item, index) => {
                    // Check if it's a placeholder
                    if (item._isPlaceholder) {
                        return `
            <div class="item-content placeholder">
              <div class="item-image"></div>
              <div class="item-details">
                <div class="item-title">████████████</div>
                <div class="item-subtitle">████████████████████████</div>
              </div>
              <div class="item-meta">
                <div class="item-date">████</div>
              </div>
            </div>
          `;
                    }

                    return `
          <div class="item-content">
            <div class="item-image">${item.letter}</div>
            <div class="item-details">
              <div class="item-title">${item.title}</div>
              <div class="item-subtitle">${item.subtitle}</div>
            </div>
            <div class="item-meta">
              <div class="item-date">${item.date}</div>
              <div class="item-status status-${item.status}">${item.status}</div>
            </div>
          </div>
        `;
                },
                adapter: {
                    read: async ({ offset, limit }) => {
                        log("fetch", `offset=${offset}, limit=${limit}`);
                        const result = await fetchItems(offset, limit);
                        log(
                            "loaded",
                            `${result.items.length} items (total: ${result.total})`,
                        );
                        return result;
                    },
                },
            });

            // Update stats
            const updateStats = () => {
                const domCount =
                    document.querySelectorAll(".vlist-item").length;
                document.getElementById("dom-count").textContent = domCount;
                document.getElementById("loaded-count").textContent =
                    list.total > 0
                        ? Math.min(list.total, list.items.length)
                        : "0";
                document.getElementById("total-count").textContent =
                    list.total > 0 ? list.total.toLocaleString() : "?";
            };

            // Event listeners
            list.on("load:start", ({ offset, limit }) => {
                document.getElementById("status").textContent = "Loading...";
                document.getElementById("status").classList.add("loading");
            });

            list.on("load:end", ({ items, total }) => {
                document.getElementById("status").textContent = "Ready";
                document.getElementById("status").classList.remove("loading");
                updateStats();
            });

            list.on("error", ({ error, context }) => {
                log("error", `${context}: ${error.message}`);
                document.getElementById("status").textContent = "Error!";
            });

            list.on("scroll", () => {
                updateStats();
            });

            list.on("range:change", ({ range }) => {
                log("range", `${range.start} - ${range.end}`);
            });

            // Controls
            document
                .getElementById("reload")
                .addEventListener("click", async () => {
                    log("action", "Reloading data...");
                    await list.reload();
                });

            document
                .getElementById("scroll-to-500")
                .addEventListener("click", () => {
                    log("action", "Scrolling to item #500");
                    list.scrollToIndex(499, "center");
                });

            document
                .getElementById("scroll-to-end")
                .addEventListener("click", () => {
                    log("action", "Scrolling to end");
                    list.scrollToIndex(TOTAL_ITEMS - 1, "end");
                });

            const delaySlider = document.getElementById("delay");
            const delayValue = document.getElementById("delay-value");

            delaySlider.addEventListener("input", () => {
                simulatedDelay = parseInt(delaySlider.value);
                delayValue.textContent = `${simulatedDelay}ms`;
            });

            // Initial stats
            updateStats();
            log("init", "Virtual list initialized");
        </script>
    </body>
</html>
